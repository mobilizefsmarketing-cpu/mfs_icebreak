<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
<title>ëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤ì½”ë¦¬ì•„ "ì•„ì´ìŠ¤ ë¸Œë ˆì´ì»¤"</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: radial-gradient(circle at center, #154734, #000); /* ë”¥ ê·¸ë¦° ë°°ê²½ */
    color: white;
    font-family: "Pretendard", sans-serif;
    touch-action: none;
    position: relative; /* ìì‹ ìš”ì†Œì˜ absolute positioning ê¸°ì¤€ */
  }

  /* ğŸ„ í¬ë¦¬ìŠ¤ë§ˆìŠ¤ í…Œë§ˆ - ì‚°íƒ€í´ë¡œìŠ¤ ì¶”ê°€ (ì œê±°ë¨) */
  #gameContainer::before {
    content: '';
    position: absolute;
    top: 5%; /* ìƒë‹¨ì—ì„œ ì¡°ê¸ˆ ë‚´ë ¤ì˜¤ê²Œ */
    left: 50%;
    transform: translateX(-50%) rotateY(0deg); 
    width: 150px; /* ì‚°íƒ€ ì´ë¯¸ì§€ í¬ê¸° */
    height: 150px;
    /* ğŸš¨ ì‚°íƒ€ ì´ë¯¸ì§€ URL ì œê±°: imgbb.com ì˜¤ë¥˜ ë°©ì§€ */
    /* background-image: url('https://i.ibb.co/L50HjW7/santa-claus.png'); */ 
    background-size: contain;
    background-repeat: no-repeat;
    z-index: 1; /* ìº”ë²„ìŠ¤ ë’¤ì— ìœ„ì¹˜ */
    animation: santaFloat 10s ease-in-out infinite alternate; /* ì‚°íƒ€ ì›€ì§ì„ ì• ë‹ˆë©”ì´ì…˜ */
    filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.5)); 
  }

  /* ğŸ„ í¬ë¦¬ìŠ¤ë§ˆìŠ¤ í…Œë§ˆ - ë§‰ëŒ€ì‚¬íƒ• ì¶”ê°€ (íŒŒì¼ëª…: candy2.pngìœ¼ë¡œ ë³€ê²½) */
  #gameContainer::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    /* ğŸš¨ íŒŒì¼ëª… ë³€ê²½ ì ìš©: candy2.png */
    background-image: 
      url('candy2.png'), 
      url('candy2.png'),
      url('candy2.png');
    background-size: 100px 100px; /* ë§‰ëŒ€ì‚¬íƒ• í¬ê¸° */
    background-position: 
      10% 20%, /* ì¢Œìƒë‹¨ */
      90% 60%, /* ìš°í•˜ë‹¨ */
      20% 80%; /* ì¢Œí•˜ë‹¨ */
    background-repeat: no-repeat;
    z-index: 0; /* ìº”ë²„ìŠ¤ ê°€ì¥ ë’¤ì— ìœ„ì¹˜ */
    opacity: 0.5; /* íˆ¬ëª…ë„ ì¡°ì ˆ */
    animation: candyCaneRotate 15s linear infinite; /* ë§‰ëŒ€ì‚¬íƒ• íšŒì „ ì• ë‹ˆë©”ì´ì…˜ */
  }

  /* ğŸ„ í¬ë¦¬ìŠ¤ë§ˆìŠ¤ í…Œë§ˆ - ëˆˆì†¡ì´ íš¨ê³¼ */
  .snowflake {
    position: absolute;
    background: #fff;
    border-radius: 50%;
    opacity: 0.8;
    animation: fall linear infinite;
    pointer-events: none; /* í´ë¦­ ë°©ì§€ */
    z-index: 0; /* ë°°ê²½ì— ìœ„ì¹˜ */
  }

  #gameContainer {
    position: relative;
    width: 100%;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  canvas {
    border: 5px solid #C90016; /* ë ˆë“œ í…Œë‘ë¦¬ */ 
    border-radius: 15px;
    background: radial-gradient(circle at 30% 30%, #004d40, #000); /* ê·¸ë¦° ë°°ê²½ */ 
    box-shadow: 0 0 25px #C90016; /* ë ˆë“œ ê·¸ë¦¼ì */ 
    touch-action: none;
    z-index: 2; /* ì‚°íƒ€ì™€ ë§‰ëŒ€ì‚¬íƒ•ë³´ë‹¤ ì•ì— */
  }
  #scoreBoard {
    position: absolute;
    top: 10px;
    right: 10px;
    font-size: 16px;
    background: rgba(0,0,0,0.5);
    padding: 6px 12px;
    border-radius: 10px;
    z-index: 3; /* ë‹¤ë¥¸ UIë³´ë‹¤ ìœ„ì— */
  }
  #intro {
    position: absolute;
    inset: 0;
    background: black;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    color: #FFD700; /* ê³¨ë“œ í…ìŠ¤íŠ¸ */ 
    font-size: 1.6rem;
    line-height: 2.5rem;
    font-weight: bold;
    z-index: 5;
  }
  /* ë¡œê³  ìŠ¤íƒ€ì¼ ìœ ì§€ */
  #intro img {
    /* ğŸš¨ ë¡œê³  í¬ê¸° ì¡°ì ˆ: 150px -> 250px */
    width: 250px; 
    margin-bottom: 20px; /* ë¡œê³ ì™€ í…ìŠ¤íŠ¸ ê°„ ê°„ê²© */
  }
  #startBtn {
    margin-top: 30px;
    background: #C90016; /* ë ˆë“œ ë²„íŠ¼ */ 
    color: white;
    border: none;
    border-radius: 10px;
    padding: 12px 24px;
    font-size: 1.1rem;
    cursor: pointer;
  }
  #quiz {
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.85);
    color: white;
    display: none;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    z-index: 6;
    padding: 0 20px;
  }
  #quiz h2 {
    font-size: 1.3rem;
    margin-bottom: 1.2rem;
    line-height: 1.6rem;
    word-break: keep-all;
    white-space: pre-line;
  }
  .quiz-btn-container {
    display: flex;
    gap: 20px;
    justify-content: center;
  }
  .quiz-btn {
    background: #008000; /* ê·¸ë¦° ë²„íŠ¼ */ 
    color: white;
    border: none;
    border-radius: 10px;
    padding: 10px 30px;
    font-size: 1.2rem;
    cursor: pointer;
  }
  #timer {
    font-size: 1rem;
    margin-top: 10px;
    color: #FFD700; /* ê³¨ë“œ íƒ€ì´ë¨¸ */ 
  }
  #resultMsg, #lifeMsg {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 1.4rem; 
    font-weight: bold;
    background: rgba(0,0,0,0.7);
    padding: 15px 25px; 
    border-radius: 12px;
    display: none;
    z-index: 8;
    text-align: center;
    white-space: pre-line;
  }
  #finalResult {
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.9);
    color: #C90016; /* ë ˆë“œ í…ìŠ¤íŠ¸ (íŒ¨ë°° ì‹œ) */ 
    display: none;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    font-size: 1.5rem;
    z-index: 7;
    text-align: center;
  }
  #retryBtn {
    margin-top: 20px;
    background: #C90016; /* ë ˆë“œ ë²„íŠ¼ */ 
    color: white;
    border: none;
    border-radius: 10px;
    padding: 12px 24px;
    font-size: 1.1rem;
    cursor: pointer;
  }

  /* ğŸ„ ì‚°íƒ€ ì›€ì§ì„ ì• ë‹ˆë©”ì´ì…˜ */
  @keyframes santaFloat {
    0% { transform: translateX(-50%) translateY(0px) rotateY(0deg); }
    50% { transform: translateX(-50%) translateY(10px) rotateY(10deg); }
    100% { transform: translateX(-50%) translateY(0px) rotateY(0deg); }
  }

  /* ğŸ„ ë§‰ëŒ€ì‚¬íƒ• íšŒì „ ì• ë‹ˆë©”ì´ì…˜ */
  @keyframes candyCaneRotate {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  /* ğŸ„ ëˆˆì†¡ì´ ì• ë‹ˆë©”ì´ì…˜ */
  @keyframes fall {
    0% {
      transform: translateY(-100%) rotate(0deg);
      opacity: 0;
    }
    10% {
      opacity: 0.8;
    }
    100% {
      transform: translateY(100vh) rotate(720deg);
      opacity: 0;
    }
  }
</style>
</head>
<body>
  <div id="gameContainer">
    <audio id="bgm" loop preload="auto">
        <source src="http://soundimage.org/wp-content/uploads/2016/10/Arcade-Fantasy.mp3" type="audio/mpeg">
    </audio>
    <audio id="bounceSfx" preload="auto">
        <source src="https://static.elevenlabs.io/sound-effects/bounce-2.mp3" type="audio/mpeg">
    </audio>
    <audio id="clickSfx" preload="auto">
        <source src="https://static.elevenlabs.io/sound-effects/bounce-2.mp3" type="audio/mpeg">
    </audio>

    <div id="intro">
      <img src="logo2.png" alt="ëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤ ë¡œê³ ">
      <div>ëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤</div>
      <div>ì œê³µ</div>
      <div>"ì•„ì´ìŠ¤ ë¸Œë ˆì´ì»¤"</div>
      <button id="startBtn" style="display:none;" onclick="startGame()">ê²Œì„ ì‹œì‘í•˜ê¸°</button>
    </div>

    <div id="quiz">
      <h2 id="questionText"></h2>
      <div class="quiz-btn-container">
        <button class="quiz-btn" onclick="answerQuiz(true)">O</button>
        <button class="quiz-btn" onclick="answerQuiz(false)">X</button>
      </div>
      <div id="timer"></div>
    </div>

    <canvas id="gameCanvas"></canvas>
    <div id="scoreBoard">ì ìˆ˜: 0 | ë¼ì´í”„: 3 | ê³µ ê°œìˆ˜: 1</div>
    <div id="resultMsg"></div>
    <div id="lifeMsg"></div>

    <div id="finalResult">
      <div id="finalText"></div>
      <button id="retryBtn" onclick="returnToIntro()">ë‹¤ì‹œ ë„ì „í•˜ê¸°</button>
    </div>
  </div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
let width = window.innerWidth * 0.9;
let height = window.innerHeight * 0.6;
canvas.width = width;
canvas.height = height;

window.addEventListener("resize", () => {
  width = window.innerWidth * 0.9;
  height = window.innerHeight * 0.6;
  canvas.width = width;
  canvas.height = height;
});

// ğŸ„ ëˆˆì†¡ì´ ìƒì„± í•¨ìˆ˜
function createSnowflake() {
  const snowflake = document.createElement('div');
  snowflake.classList.add('snowflake');
  document.getElementById('gameContainer').appendChild(snowflake);

  const size = Math.random() * 5 + 5; // 5px ~ 10px
  snowflake.style.width = size + 'px';
  snowflake.style.height = size + 'px';
  snowflake.style.left = Math.random() * 100 + '%';
  snowflake.style.animationDuration = Math.random() * 10 + 5 + 's'; // 5s ~ 15s
  snowflake.style.animationDelay = Math.random() * 5 + 's'; // 
  
  // ìˆ˜ëª…ì´ ë‹¤í•œ ëˆˆì†¡ì´ ì œê±°
  snowflake.addEventListener('animationend', () => {
    snowflake.remove();
    createSnowflake(); // ìƒˆ ëˆˆì†¡ì´ ì¬ìƒì„±
  });
}

// ğŸ„ ì—¬ëŸ¬ ê°œì˜ ëˆˆì†¡ì´ ìƒì„±
for (let i = 0; i < 50; i++) {
  createSnowflake();
}


// ì˜¤ë””ì˜¤ ìš”ì†Œ
const bgm = document.getElementById('bgm');
const bounceSfx = document.getElementById('bounceSfx');
const clickSfx = document.getElementById('clickSfx');

// ë³¼ë¥¨ ì„¤ì •
bgm.volume = 0.2; 
bounceSfx.volume = 0.5; 
clickSfx.volume = 0.6; 

function playSfx(audioElement) {
    audioElement.currentTime = 0; 
    audioElement.play().catch(e => console.log("Audio playback failed:", e));
}

// ğŸš€ ê³µì˜ ì†ë„ ê´€ë ¨ ë³€ìˆ˜: ì†ë„ ìƒí–¥
const SPEED_CHANGE = 0.3; 
const MAX_SPEED = 4.0; 
const MIN_SPEED = 2.0; 
const NUM_BOMBS = 3; 

// ê³µ ë°°ì—´ë¡œ ë³€ê²½
let balls = []; 
let paddle = { w: 80, h: 10, x: width / 2 - 40 };
let bricks = [];
let score = 0, lives = 3;
let gameRunning = false;
let gameWon = false; 
let quizActive = false;
let quizTimer, timeLeft = 10;
let quizInterval;
let pausedForResult = false;

// ğŸ”¢ ê³µ ê°œìˆ˜ ì¦ê°€ ë¡œì§ì„ ìœ„í•œ ë³€ìˆ˜ ì¶”ê°€
let extraBalls = 0; 

const quizBox = document.getElementById("quiz");
const questionText = document.getElementById("questionText");
const timerDisplay = document.getElementById("timer");
const resultMsg = document.getElementById("resultMsg");
const lifeMsg = document.getElementById("lifeMsg");

// í€´ì¦ˆ ëª©ë¡ (ìš”ì²­ì— ë”°ë¼ 5ê°œ ì§ˆë¬¸ ì œì™¸ë¨: ë³¸ì‚¬ ì£¼ì†Œ, ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸, ëŒ€í‘œì´ì‚¬, ê³ ê°ì„¼í„° ë²ˆí˜¸, ì‚¬ëª… ë³€ê²½)
const allQuizzes = [
  { q: "ê·¸ë‘ì½œë ˆì˜¤ìŠ¤ 26ë…„ ìƒì‚°ê¸°ì¤€\n3.3% ê¸ˆë¦¬ í• ë¶€ì›ê¸ˆì œí•œì€\n2500ë§Œì› ìˆë‹¤?", a: true },
  { q: "ëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤ëŠ”\ní”„ë‘ìŠ¤ íšŒì‚¬ë‹¤?", a: true },
  { q: "ì”ê°€ë³´ì¥ìƒí’ˆì€\nëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤ì—ë§Œ ìˆëŠ”\ní• ë¶€ìƒí’ˆì´ë‹¤?", a: false },
  { q: "ëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤ì˜ ê³µì‹ ê¸ˆìœµ íŒŒíŠ¸ë„ˆëŠ”\në¥´ë…¸ê·¸ë£¹ì´ë‹¤?", a: true },
  { q: "ëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤ ì½”ë¦¬ì•„ëŠ”\ní• ë¶€, ë¦¬ìŠ¤, ì¤‘ê³ ì°¨ ì‚¬ì—… ë¶„ì•¼ì— ê±¸ì¹œ\nì¢…í•© ê¸ˆìœµ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•œë‹¤?", a: true },
  { q: "ëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤ ì½”ë¦¬ì•„ëŠ”\në¥´ë…¸ì½”ë¦¬ì•„ìë™ì°¨ì˜ ê¸ˆìœµ íŒŒíŠ¸ë„ˆë¡œ,\n2023ë…„ í•œêµ­ ì§„ì¶œ 20ì£¼ë…„ì„ ë§ì´í–ˆë‹¤?", a: true },
  { q: "ëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤ì˜ ì´ì „ ì‚¬ëª…ì€\n'ë¥´ë…¸íŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤ì½”ë¦¬ì•„'ì˜€ë‹¤?", a: true },
  { q: "ëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤ì˜ ê¸ˆìœµìƒí’ˆ ì¤‘\nì‹ ì°¨í• ë¶€ëŠ” ì—†ë‹¤?", a: false },
  { q: "ëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤ëŠ” ì „ ì„¸ê³„ì ìœ¼ë¡œ\në¥´ë…¸Â·ë‹›ì‚°Â·ë¯¸ì“°ë¹„ì‹œ ê³ ê°ì—ê²Œ\nê¸ˆìœµ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•œë‹¤?", a: true },
  { q: "ëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤ì˜ ìƒí’ˆ ì¤‘\nìš´ìš©ë¦¬ìŠ¤(Lease)ë¥¼ ì´ìš©í•˜ë©´\nì¥ê¸°ë ŒíŠ¸ì™€ ê°™ì´ 'í•˜', 'í—ˆ', 'í˜¸' ë²ˆí˜¸íŒì„ ì‚¬ìš©í•˜ê²Œ ëœë‹¤?", a: false },
  { q: "ìš´ìš©ë¦¬ìŠ¤ì˜ ê³„ì•½ ë§Œê¸° ì‹œ ì°¨ëŸ‰ ë°˜ë‚©, ì´ìš© ê¸°ê°„ ì—°ì¥,\nì°¨ëŸ‰ êµ¬ë§¤ ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•  ìˆ˜ ìˆë‹¤?", a: true },
  { q: "ì¤‘ê³ ì°¨ ì˜¤í† ë¡ ì˜ ëŒ€ì¶œ ìµœê³  ê¸ˆë¦¬ëŠ”\nì—° 18%ì´ë‹¤?", a: true },
  { q: "ëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤ëŠ” ê³ ê°ì—ê²Œ\nì°¨ëŸ‰ìœ ì§€ ë° ê´€ë¦¬ì— ë„ì›€ì´ ë˜ëŠ”\nì œíœ´ ë³´í—˜ ì„œë¹„ìŠ¤ ìƒí’ˆë„ ì œê³µí•œë‹¤?", a: true },
  { q: "ëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤ì˜ ëª¨ë°”ì¼ ì•±ì€\ní• ë¶€ê¸ˆìœµì´ í•„ìš”í•œ ê³ ê°ì—ê²Œ\në””ì§€í„¸ í• ë¶€ ê¸ˆìœµ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•œë‹¤?", a: true },
  { q: "ëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤ ì½”ë¦¬ì•„ëŠ”\n2003ë…„ì— êµ­ë‚´ ë²•ì¸ì´ ì„¤ë¦½ë˜ì—ˆë‹¤?", a: true },
  { q: "ë¦¬ìŠ¤ ìƒí’ˆ ì¤‘ ê¸ˆìœµë¦¬ìŠ¤ëŠ” ìš´ìš©ë¦¬ìŠ¤ì™€ ë‹¬ë¦¬\nê³„ì•½ ë§Œê¸° ì‹œ ì°¨ëŸ‰ ë°˜ë‚©ì´ ë¶ˆê°€ëŠ¥í•˜ë‹¤?", a: true },
  { q: "ëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤ì˜ ë³¸ì‚¬ ìœ„ì¹˜ëŠ”\ní”„ë‘ìŠ¤ íŒŒë¦¬ì´ë‹¤?", a: true }
];

let availableQuizIndices = []; 

function resetQuizAvailability() {
    availableQuizIndices = [...Array(allQuizzes.length).keys()];
    for (let i = availableQuizIndices.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [availableQuizIndices[i], availableQuizIndices[j]] = [availableQuizIndices[j], availableQuizIndices[i]];
    }
}

canvas.addEventListener("touchmove", e => {
  const touch = e.touches[0];
  const rect = canvas.getBoundingClientRect();
  paddle.x = touch.clientX - rect.left - paddle.w / 2;
});
canvas.addEventListener("mousemove", e => {
  const rect = canvas.getBoundingClientRect();
  paddle.x = e.clientX - rect.left - paddle.w / 2;
});

function createLogoBricks() {
  const brickW = 40, brickH = 16;
  const brickGap = 4;
  const cx = width / 2, cy = height / 3;
  const outer = 160, inner = 90;
  bricks = [];
  const allBrickPositions = []; 

  // 1. ëª¨ë“  ë²½ëŒ ìƒì„± (í­íƒ„ ì—¬ë¶€ ì œì™¸)
  for (let y = 40; y < height / 1.5; y += brickH + brickGap) {
    for (let x = 40; x < width - 40; x += brickW + brickGap) {
      const dx = x - cx, dy = y - cy;
      const dist = Math.sqrt(dx * dx + dy * dy);
      const angle = Math.atan2(dy, dx);
      const circlePart = dist < outer && dist > inner && (angle < -0.5 || angle > 0.5);
      const slash = Math.abs(dy + dx * 0.5) < 20;
      
      if (circlePart || slash) {
        const newBrick = {
          x, y, w: brickW, h: brickH, 
          // ğŸ„ í¬ë¦¬ìŠ¤ë§ˆìŠ¤ í…Œë§ˆ: ìŠ¬ë˜ì‹œëŠ” ë ˆë“œ, ì„œí´ ë¶€ë¶„ì€ ê·¸ë¦°
          color: slash ? "#C90016" : "#008000", 
          visible: true, 
          isBomb: false, 
          bombHits: 0, 
          row: Math.floor((y - 40) / (brickH + brickGap)),
          col: Math.floor((x - 40) / (brickW + brickGap))
        };
        bricks.push(newBrick);
        allBrickPositions.push(bricks.length - 1);
      }
    }
  }

  // 2. í­íƒ„ ë²½ëŒ ë¬´ì‘ìœ„ ì„ ì •
  const bombIndices = [];
  while (bombIndices.length < NUM_BOMBS && allBrickPositions.length > 0) {
    const randomIndexInPos = Math.floor(Math.random() * allBrickPositions.length);
    const brickIndex = allBrickPositions.splice(randomIndexInPos, 1)[0];
    
    // í­íƒ„ ì†ì„± ì¶”ê°€
    bricks[brickIndex].isBomb = true;
    bricks[brickIndex].bombHits = 3;
    bombIndices.push(brickIndex);
  }
}

function drawBricks() {
  bricks.forEach(b => {
    if (!b.visible) return;
    
    ctx.shadowBlur = 10;
    // ì¼ë°˜ ë²½ëŒì€ í•´ë‹¹ ìƒ‰ìƒì˜ ê·¸ë¦¼ì
    ctx.shadowColor = b.color;
    
    if (b.isBomb) {
        // ğŸ„ í¬ë¦¬ìŠ¤ë§ˆìŠ¤ í…Œë§ˆ: ê³¨ë“œ í…Œë‘ë¦¬, ë ˆë“œ ì¤‘ì•™ (ì„ ë¬¼/ì¥ì‹ ëŠë‚Œ)
        ctx.fillStyle = '#FFD700'; // Gold Outline
        ctx.fillRect(b.x, b.y, b.w, b.h);
        
        // Red Center, ë°ê¸°ê°€ íˆíŠ¸ íšŸìˆ˜ì— ë”°ë¼ ë³€ê²½
        ctx.fillStyle = b.bombHits === 3 ? '#C90016' : 
                        b.bombHits === 2 ? '#B30000' :
                        '#800000'; 
        ctx.fillRect(b.x + 2, b.y + 2, b.w - 4, b.h - 4);

        // ë‚¨ì€ íšŸìˆ˜ í‘œì‹œ
        ctx.fillStyle = 'white'; // White count
        ctx.font = '10px Arial';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(b.bombHits, b.x + b.w / 2, b.y + b.h / 2);
    } else {
        // ì¼ë°˜ ë²½ëŒ
        ctx.fillStyle = b.color;
        ctx.fillRect(b.x, b.y, b.w, b.h);
    }
  });
  ctx.shadowBlur = 0;
}

// í­íƒ„ ë²½ëŒ í­ë°œ ë¡œì§ (ë³€ê²½ ì—†ìŒ)
function explodeBomb(bombBrick) {
    const explosionScore = 10;
    const { row: targetRow, col: targetCol } = bombBrick;
    
    const positionsToClear = [];
    for (let dr = -1; dr <= 1; dr++) {
        for (let dc = -1; dc <= 1; dc++) {
            positionsToClear.push({ row: targetRow + dr, col: targetCol + dc });
        }
    }

    bricks.forEach(brick => {
        if (!brick.visible) return;
        
        const isNear = positionsToClear.some(pos => pos.row === brick.row && pos.col === brick.col);
        
        if (isNear) {
            brick.visible = false;
            score += explosionScore; 
        }
    });

    updateScore();
}

// ğŸ¯ ê³µì„ ê·¸ë¦¬ëŠ” í•¨ìˆ˜ (balls ë°°ì—´ ìˆœíšŒ)
function drawBall(ball) {
  ctx.beginPath();
  ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI * 2);
  ctx.fillStyle = "#fff"; // ğŸ„ í¬ë¦¬ìŠ¤ë§ˆìŠ¤ í…Œë§ˆ: í°ìƒ‰ ê³µ
  ctx.shadowBlur = 15;
  ctx.shadowColor = "#FFD700"; // ğŸ„ í¬ë¦¬ìŠ¤ë§ˆìŠ¤ í…Œë§ˆ: ê³¨ë“œ ê·¸ë¦¼ì
  ctx.fill();
  ctx.closePath();
  ctx.shadowBlur = 0;
}

function drawPaddle() {
  // ğŸ„ í¬ë¦¬ìŠ¤ë§ˆìŠ¤ í…Œë§ˆ: ë ˆë“œ íŒ¨ë“¤
  ctx.fillStyle = "#C90016"; 
  ctx.fillRect(paddle.x, height - 30, paddle.w, paddle.h);
}

function draw() {
  ctx.clearRect(0, 0, width, height);
  drawBricks();
  balls.forEach(drawBall); // ëª¨ë“  ê³µì„ ê·¸ë¦¼
  drawPaddle();
}

// ìƒˆë¡œìš´ ê³µì„ ìƒì„±í•˜ê³  balls ë°°ì—´ì— ì¶”ê°€í•˜ëŠ” í•¨ìˆ˜
function createNewBall() {
    // í˜„ì¬ ì¡´ì¬í•˜ëŠ” ê³µ ì¤‘ í•˜ë‚˜ì˜ ì†ë„ë¥¼ ë³µì‚¬í•˜ì—¬ ìƒˆë¡œìš´ ê³µì— ì ìš©
    let newDx = MIN_SPEED;
    let newDy = -MIN_SPEED;

    if (balls.length > 0) {
        const existingBall = balls[0];
        // ìƒˆë¡œìš´ ê³µì€ íŠ•ê¸°ì§€ ì•Šë„ë¡ ì´ˆê¸° ì†ë„(MIN_SPEED)ë¡œ ì‹œì‘í•˜ë„ë¡ ë³€ê²½
        newDx = (Math.random() > 0.5 ? 1 : -1) * MIN_SPEED; 
        newDy = -MIN_SPEED; 
    }
    
    // ìƒˆë¡œìš´ ê³µì€ íŒ¨ë“¤ ì¤‘ì•™ì—ì„œ ì‹œì‘
    const newBall = { 
        x: paddle.x + paddle.w / 2, 
        y: height - 40, 
        dx: newDx, 
        dy: newDy, 
        r: 8 
    };
    balls.push(newBall);
    updateScore();
}

function update() {
  if (!gameRunning || quizActive || pausedForResult) return;
  
  // ğŸ§± ìŠ¹ë¦¬ ì¡°ê±´ í™•ì¸: ë‚¨ì€ ë²½ëŒ ê°œìˆ˜ ì„¸ê¸°
  const visibleBricks = bricks.filter(b => b.visible).length;
  if (visibleBricks === 0) {
      gameWon = true; // ìŠ¹ë¦¬ í”Œë˜ê·¸ ì„¤ì •
      endGame();
      return;
  }
  
  // ì¶©ëŒ ê°ì§€ë¥¼ ìœ„í•´ ìƒˆë¡œìš´ ë°°ì—´ ìƒì„±
  const newBalls = [];
  let bounced = false;

  balls.forEach(ball => {
    
    // 1. ê³µ ì´ë™
    ball.x += ball.dx;
    ball.y += ball.dy;

    // 2. ë²½ ì¶©ëŒ
    if (ball.x + ball.r > width || ball.x - ball.r < 0) {
        ball.dx *= -1;
        bounced = true;
    }
    if (ball.y - ball.r < 0) {
        ball.dy *= -1;
        bounced = true;
    }

    // 3. íŒ¨ë“¤ ì¶©ëŒ
    if (ball.y + ball.r > height - 30 && ball.x > paddle.x && ball.x < paddle.x + paddle.w) {
      // íŒ¨ë“¤ ì¶©ëŒ ì‹œ ê³µì˜ ë°©í–¥ì„ íŒ¨ë“¤ ìœ„ì¹˜ì— ë”°ë¼ ì¡°ì ˆ 
      let relativeX = ball.x - (paddle.x + paddle.w / 2);
      let normalizedX = relativeX / (paddle.w / 2); 

      let currentSpeed = Math.sqrt(ball.dx * ball.dx + ball.dy * ball.dy);
      // X ë°©í–¥ ì†ë„ ë³€ê²½ (ìµœëŒ€ 45ë„ ë°˜ì‚¬)
      ball.dx = normalizedX * currentSpeed; 
      // Y ë°©í–¥ ì†ë„ ê³ ì •
      ball.dy = -Math.abs(currentSpeed);
      
      // ì†ë„ê°€ ìµœëŒ€ ì†ë„ë¥¼ ë„˜ì§€ ì•Šë„ë¡ ì¬ì¡°ì •
      if (currentSpeed > MAX_SPEED) {
          let factor = MAX_SPEED / currentSpeed;
          ball.dx *= factor;
          ball.dy *= factor;
      }

      bounced = true;
    }
    
    // 4. ë²½ëŒ ì¶©ëŒ
    bricks.forEach(b => {
      if (b.visible &&
          ball.x > b.x && ball.x < b.x + b.w &&
          ball.y > b.y && ball.y < b.y + b.h) {
        
        // ê³µ ë°˜ì‚¬
        ball.dy *= -1; 
        bounced = true;
        
        if (b.isBomb) {
          b.bombHits--;
          if (b.bombHits <= 0) {
              explodeBomb(b); 
          }
        } else {
          // ì¼ë°˜ ë²½ëŒ ì²˜ë¦¬
          b.visible = false;
          score += 10;
          updateScore();
        }
      }
    });

    // 5. ê³µì„ ìƒì€ ê²½ìš°
    if (ball.y > height) {
      // ì´ ê³µì€ ë²„ë ¤ì§
    } else {
      newBalls.push(ball); // ìƒì§€ ì•Šì€ ê³µë§Œ ìƒˆ ë°°ì—´ì— ì¶”ê°€
    }
  });

  balls = newBalls; // ì‚´ì•„ë‚¨ì€ ê³µë§Œ ë‚¨ê¹€

  // 6. ê³µì´ íŠ•ê²¼ë‹¤ë©´ íš¨ê³¼ìŒ ì¬ìƒ
  if (bounced) {
      playSfx(bounceSfx);
  }

  // 7. ëª¨ë“  ê³µì„ ìƒì—ˆì„ ë•Œ ë¼ì´í”„ ì²˜ë¦¬ (ê²Œì„ ì˜¤ë²„ ì¡°ê±´)
  if (balls.length === 0) {
    lives--;
    updateScore();
    if (lives <= 0) {
      gameWon = false; // íŒ¨ë°° í”Œë˜ê·¸ ì„¤ì •
      endGame();
      return;
    } else {
      showLifeMessage(`ë¼ì´í”„ê°€ 1 ê°ì†Œí–ˆìŠµë‹ˆë‹¤.\n\në‚¨ì€ ë¼ì´í”„: ${lives}`);
      // ë¼ì´í”„ë¥¼ ìƒìœ¼ë©´ ì´ˆê¸° ê³µ 1ê°œë§Œ ë‹¤ì‹œ ìƒì„±
      balls = [];
      createNewBall(); 
    }
  }

  draw();
  requestAnimationFrame(update);
}

function updateScore() {
  document.getElementById("scoreBoard").textContent = `ì ìˆ˜: ${score} | ë¼ì´í”„: ${lives} | ê³µ ê°œìˆ˜: ${balls.length}`;
}

function startQuiz() {
  if (!gameRunning) return;
  quizActive = true;
  gameRunning = false;
  
  if (availableQuizIndices.length === 0) {
      resetQuizAvailability(); 
  }
  const randomIndexInAvailable = Math.floor(Math.random() * availableQuizIndices.length);
  const quizIndex = availableQuizIndices.splice(randomIndexInAvailable, 1)[0];
  const q = allQuizzes[quizIndex];
  
  questionText.textContent = q.q;
  quizBox.style.display = "flex";
  timeLeft = 10;
  timerDisplay.textContent = `ë‚¨ì€ ì‹œê°„: ${timeLeft}s`;
  quizTimer = setInterval(() => {
    timeLeft--;
    timerDisplay.textContent = `ë‚¨ì€ ì‹œê°„: ${timeLeft}s`;
    if (timeLeft <= 0) {
      clearInterval(quizTimer);
      checkAnswer(false, q.a);
    }
  }, 1000);
  quizBox.dataset.answer = q.a;
}

function stopQuizTimer() {
  if (quizTimer) clearInterval(quizTimer);
}

function adjustBallSpeed(isCorrect) {
    if (balls.length === 0) return;
    
    // ëŒ€í‘œ ì†ë„ ì¡°ì •
    let speed = Math.abs(balls[0].dy);
    
    if (isCorrect) {
        // ì •ë‹µ: ì†ë„ë¥¼ 0.3 ê°ì†Œì‹œì¼œ ì‰½ê²Œ ë§Œë“¦. MIN_SPEED(2.0)ë³´ë‹¤ ì‘ì•„ì§€ì§€ ì•ŠìŒ.
        speed = Math.max(MIN_SPEED, speed - SPEED_CHANGE); 
    } else {
        // ì˜¤ë‹µ: ì†ë„ë¥¼ 0.3 ì¦ê°€ì‹œì¼œ ì–´ë µê²Œ ë§Œë“¦. MAX_SPEED(4.0)ë¥¼ ì´ˆê³¼í•˜ì§€ ì•ŠìŒ.
        speed = Math.min(MAX_SPEED, speed + SPEED_CHANGE); 
    }
    
    // ëª¨ë“  ê³µì— ì¡°ì •ëœ ì†ë„ë¥¼ ì ìš© (ë°©í–¥ì€ ìœ ì§€)
    balls.forEach(ball => {
        let currentFactor = Math.abs(ball.dy) / speed;
        
        // ê³µì˜ dx, dy ë¹„ìœ¨ì„ ìœ ì§€í•˜ë©´ì„œ speedë¥¼ ì ìš©
        if (ball.dy < 0) {
            ball.dy = -speed;
        } else {
            ball.dy = speed;
        }
        ball.dx /= currentFactor;
        
        // ë„ˆë¬´ ë¹¨ë¼ì§€ëŠ” ê²ƒì„ ë°©ì§€í•˜ê¸° ìœ„í•´ MAX_SPEED ì¬í™•ì¸
        let currentTotalSpeed = Math.sqrt(ball.dx * ball.dx + ball.dy * ball.dy);
        if (currentTotalSpeed > MAX_SPEED) {
            let factor = MAX_SPEED / currentTotalSpeed;
            ball.dx *= factor;
            ball.dy *= factor;
        }
    });
}

function answerQuiz(ans) {
  playSfx(clickSfx); 
  stopQuizTimer();
  const correct = quizBox.dataset.answer === "true";
  checkAnswer(ans, correct);
}

function showResultMessage(text, color) {
  resultMsg.textContent = text;
  resultMsg.style.color = color;
  resultMsg.style.display = "block";
  pausedForResult = true;
  setTimeout(() => {
    resultMsg.style.display = "none";
    pausedForResult = false;
    gameRunning = true;
    update();
  }, 1500);
}

function showLifeMessage(text) {
  pausedForResult = true;
  lifeMsg.textContent = text;
  lifeMsg.style.display = "block";
  setTimeout(() => {
    lifeMsg.style.display = "none";
    pausedForResult = false;
    gameRunning = true;
    update();
  }, 1500);
}

function checkAnswer(selected, correct) {
  quizBox.style.display = "none";
  quizActive = false;
  
  // ì†ë„ ì¡°ì •
  adjustBallSpeed(selected === correct);

  if (selected === correct) {
    // ğŸ”¢ ì •ë‹µ: 200ì  íšë“ (ì ìˆ˜ ë¡œì§ ìœ ì§€)
    score += 200;
    
    // ğŸ”¢ í€´ì¦ˆ ì •ë‹µ ì‹œ ê³µ ê°œìˆ˜ 2ì§„ìˆ˜ë¡œ ì¦ê°€
    if (extraBalls === 0) {
        extraBalls = 1; // 2^0 = 1
    } else {
        extraBalls *= 2; // 2^n
    }
    
    // ì¦ê°€ëœ ê³µ ê°œìˆ˜ë§Œí¼ ìƒì„±
    for (let i = 0; i < extraBalls; i++) {
        createNewBall();
    }
    
    showResultMessage(`ì •ë‹µì…ë‹ˆë‹¤!\n\n+200ì !\nê³µì´ ${extraBalls}ê°œ ì¶”ê°€ë©ë‹ˆë‹¤!`, "#00ff88");
  } else {
    // ì˜¤ë‹µ: -100ì , ë¼ì´í”„ ê°ì†Œ
    score -= 100;
    lives--;
    showResultMessage("ì˜¤ë‹µì…ë‹ˆë‹¤!\n\n-100ì ", "#ff5555");
    extraBalls = 0; // ì˜¤ë‹µ ì‹œ ê³µ ê°œìˆ˜ ì¦ê°€ ì´ˆê¸°í™”
  }
  updateScore();
  if (lives <= 0) endGame();
}

function startQuizCycle() {
  quizInterval = setInterval(() => {
    if (gameRunning && !quizActive && !pausedForResult) startQuiz();
  }, 10000);
}

function stopQuizCycle() {
  if (quizInterval) clearInterval(quizInterval);
}

// ğŸ† endGame í•¨ìˆ˜ ìˆ˜ì •: ìŠ¹ë¦¬/íŒ¨ë°° ë©”ì‹œì§€ ë¶„ë¦¬
function endGame() {
  stopQuizTimer();
  stopQuizCycle();
  gameRunning = false;
  quizActive = false;
  pausedForResult = false;
  
  bgm.pause(); 
  
  let resultMessage = "";
  if (gameWon) {
      document.getElementById("finalResult").style.color = "#FFD700"; // ê³¨ë“œ ìƒ‰ìƒìœ¼ë¡œ ë³€ê²½
      resultMessage = `âœ¨ë²½ëŒ ì™„ì „ íŒŒê´´! ì¶•í•˜í•©ë‹ˆë‹¤!âœ¨ <br><br> ìµœì¢… ì ìˆ˜: ${score} <br><br> ë‚¨ì€ ë¼ì´í”„: ${lives}`;
  } else {
      document.getElementById("finalResult").style.color = "#C90016"; // ë ˆë“œ ìƒ‰ìƒ ìœ ì§€
      resultMessage = `ê²Œì„ ì˜¤ë²„! <br><br> ìµœì¢… ì ìˆ˜: ${score} <br><br> ë‚¨ì€ ë¼ì´í”„: ${lives}`;
  }
  
  document.getElementById("finalText").innerHTML = resultMessage;
  
  document.getElementById("finalResult").style.display = "flex";
}

function resetGame() {
  score = 0;
  lives = 3;
  extraBalls = 0;
  gameWon = false; // ğŸ§± ê²Œì„ ì´ˆê¸°í™” ì‹œ í”Œë˜ê·¸ ë¦¬ì…‹
  createLogoBricks();
  updateScore();
  
  balls = [];
  createNewBall(); // ì´ˆê¸° ê³µ 1ê°œ ìƒì„± (MIN_SPEED ì ìš©)
  
  resetQuizAvailability(); 
}

function returnToIntro() {
  playSfx(clickSfx); 
  document.getElementById("finalResult").style.display = "none";
  resetGame();
  document.getElementById("intro").style.display = "flex";
  document.getElementById("startBtn").style.display = "block";
}

createLogoBricks();
resetQuizAvailability();
setTimeout(() => {
  document.getElementById("startBtn").style.display = "block";
}, 3000);

function startGame() {
  playSfx(clickSfx); 
  document.getElementById("intro").style.display = "none";
  document.getElementById("finalResult").style.display = "none";
  
  resetGame(); // ê²Œì„ ì‹œì‘ ì‹œ ì´ˆê¸° ê³µ 1ê°œ ìƒì„± í¬í•¨
  
  gameRunning = true;
  startQuizCycle();
  update();
  bgm.play().catch(e => console.log("BGM playback failed: User interaction required.", e)); 
}
</script>
</body>
</html>
