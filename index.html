<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤ì½”ë¦¬ì•„ ì•„ì´ìŠ¤ë¸Œë ˆì´ì»¤ ğŸ®</title>
<style>
  body {
    margin: 0;
    background: radial-gradient(circle at 30% 30%, #04122a, #000);
    color: white;
    font-family: "Pretendard", sans-serif;
    overflow: hidden;
    text-align: center;
  }
  #intro, #gameOver, #quizPopup, #lifePopup, #resultPopup {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
  }
  #intro h1 { font-size: 1.5em; color: #00aaff; margin: 10px 0; }
  #startBtn, #restartBtn {
    background: #00aaff;
    border: none;
    color: white;
    padding: 12px 28px;
    border-radius: 10px;
    font-size: 1em;
    cursor: pointer;
  }
  #gameCanvas {
    display: block;
    margin: 80px auto 0 auto;
    border: 3px solid #00aaff;
    border-radius: 10px;
    background: rgba(0,0,0,0.4);
  }
  #scoreBoard {
    position: absolute;
    top: 10px; right: 10px;
    background: rgba(0,0,0,0.5);
    padding: 5px 15px;
    border-radius: 10px;
    font-size: 0.9em;
  }
  .popup {
    font-size: 1.3em;
    line-height: 1.5em;
    background: rgba(0,0,0,0.7);
    padding: 20px;
    border-radius: 15px;
    display: none;
  }
  #quizPopup button {
    display: inline-block;
    margin: 15px 10px;
    padding: 15px 30px;
    font-size: 1.2em;
    font-weight: bold;
    border-radius: 10px;
    border: none;
    background: #00aaff;
    color: white;
    cursor: pointer;
  }
  #timer { color: #ff4444; margin-top: 10px; font-size: 1em; }
</style>
</head>
<body>

<div id="intro">
  <h1>ëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤</h1>
  <h1>ì œê³µ</h1>
  <h1>"ì•„ì´ìŠ¤ë¸Œë ˆì´ì»¤"</h1>
  <button id="startBtn">ê²Œì„ ì‹œì‘í•˜ê¸°</button>
</div>

<canvas id="gameCanvas" width="400" height="500"></canvas>
<div id="scoreBoard">ì ìˆ˜: 0 | ë¼ì´í”„: 3</div>

<div id="quizPopup" class="popup">
  <div id="quizQuestion"></div>
  <div>
    <button id="btnO">O</button>
    <button id="btnX">X</button>
  </div>
  <div id="timer"></div>
</div>

<div id="lifePopup" class="popup"></div>
<div id="resultPopup" class="popup"></div>

<div id="gameOver" class="popup">
  <div id="finalText"></div>
  <button id="restartBtn">ë‹¤ì‹œ ë„ì „í•˜ê¸°</button>
</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const startBtn = document.getElementById("startBtn");
const restartBtn = document.getElementById("restartBtn");
const intro = document.getElementById("intro");
const gameOver = document.getElementById("gameOver");
const scoreBoard = document.getElementById("scoreBoard");
const quizPopup = document.getElementById("quizPopup");
const quizQuestion = document.getElementById("quizQuestion");
const btnO = document.getElementById("btnO");
const btnX = document.getElementById("btnX");
const timerText = document.getElementById("timer");
const lifePopup = document.getElementById("lifePopup");
const resultPopup = document.getElementById("resultPopup");
const finalText = document.getElementById("finalText");

let paddleX, ballX, ballY, ballSpeedX, ballSpeedY;
let rightPressed = false, leftPressed = false;
let score = 0, lives = 3, gameInterval;
let ballRadius = 6;
let paused = false;

const bricks = [];
const brickRowCount = 6;
const brickColumnCount = 8;
const brickWidth = 40;
const brickHeight = 15;
const brickPadding = 6;
const brickOffsetTop = 30;
const brickOffsetLeft = 18;

const quizList = [
  { q: "ëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤ëŠ”\ní”„ë‘ìŠ¤ íšŒì‚¬ë‹¤?", a: true },
  { q: "ëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤ì½”ë¦¬ì•„ëŠ”\në¥´ë…¸ì½”ë¦¬ì•„ìë™ì°¨ì˜\nê³µì‹ ê¸ˆìœµ íŒŒíŠ¸ë„ˆë‹¤?", a: true },
  { q: "ëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤ëŠ”\nìë™ì°¨ ë³´í—˜ì„ ì§ì ‘ íŒë§¤í•œë‹¤?", a: false },
];

let quizTimer;
let quizIndex = 0;

function initGame() {
  intro.style.display = "none";
  gameOver.style.display = "none";
  score = 0; lives = 3;
  scoreBoard.textContent = `ì ìˆ˜: ${score} | ë¼ì´í”„: ${lives}`;
  paddleX = (canvas.width - 70) / 2;
  ballX = canvas.width / 2;
  ballY = canvas.height - 40;
  ballSpeedX = 1; ballSpeedY = -1;
  for (let c = 0; c < brickColumnCount; c++) {
    bricks[c] = [];
    for (let r = 0; r < brickRowCount; r++) {
      bricks[c][r] = { x: 0, y: 0, status: 1 };
    }
  }
  document.addEventListener("keydown", keyDownHandler);
  document.addEventListener("keyup", keyUpHandler);
  document.addEventListener("mousemove", mouseMoveHandler);
  clearInterval(gameInterval);
  gameInterval = setInterval(draw, 10);
  setInterval(showQuiz, 10000);
}

function keyDownHandler(e) {
  if (e.key === "Right" || e.key === "ArrowRight") rightPressed = true;
  else if (e.key === "Left" || e.key === "ArrowLeft") leftPressed = true;
}
function keyUpHandler(e) {
  if (e.key === "Right" || e.key === "ArrowRight") rightPressed = false;
  else if (e.key === "Left" || e.key === "ArrowLeft") leftPressed = false;
}
function mouseMoveHandler(e) {
  let relativeX = e.clientX - canvas.offsetLeft;
  if (relativeX > 35 && relativeX < canvas.width - 35) paddleX = relativeX - 35;
}

function drawBall() {
  ctx.beginPath();
  ctx.arc(ballX, ballY, ballRadius, 0, Math.PI * 2);
  ctx.fillStyle = "#00aaff";
  ctx.fill();
  ctx.closePath();
}
function drawPaddle() {
  ctx.beginPath();
  ctx.rect(paddleX, canvas.height - 15, 70, 8);
  ctx.fillStyle = "#00ccff";
  ctx.fill();
  ctx.closePath();
}
function drawBricks() {
  for (let c = 0; c < brickColumnCount; c++) {
    for (let r = 0; r < brickRowCount; r++) {
      if (bricks[c][r].status === 1) {
        const brickX = c * (brickWidth + brickPadding) + brickOffsetLeft;
        const brickY = r * (brickHeight + brickPadding) + brickOffsetTop;
        bricks[c][r].x = brickX;
        bricks[c][r].y = brickY;
        const color = r < 3 ? "#00ccff" : "#ff6644";
        ctx.beginPath();
        ctx.rect(brickX, brickY, brickWidth, brickHeight);
        ctx.fillStyle = color;
        ctx.fill();
        ctx.closePath();
      }
    }
  }
}

function draw() {
  if (paused) return;
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  drawBricks();
  drawBall();
  drawPaddle();

  if (ballX + ballSpeedX > canvas.width - ballRadius || ballX + ballSpeedX < ballRadius) {
    ballSpeedX = -ballSpeedX;
  }
  if (ballY + ballSpeedY < ballRadius) {
    ballSpeedY = -ballSpeedY;
  } else if (ballY + ballSpeedY > canvas.height - ballRadius - 8) {
    if (ballX > paddleX && ballX < paddleX + 70) {
      ballSpeedY = -ballSpeedY;
    } else {
      lives--;
      showLifePopup();
      if (!lives) endGame();
      else resetBall();
    }
  }

  ballX += ballSpeedX;
  ballY += ballSpeedY;
  scoreBoard.textContent = `ì ìˆ˜: ${score} | ë¼ì´í”„: ${lives}`;
}

function showLifePopup() {
  paused = true;
  lifePopup.innerHTML = `ë¼ì´í”„ê°€ 1 ê°ì†Œí–ˆìŠµë‹ˆë‹¤.<br>ë‚¨ì€ ë¼ì´í”„: ${lives}`;
  lifePopup.style.display = "block";
  setTimeout(() => {
    lifePopup.style.display = "none";
    paused = false;
  }, 1500);
}

function resetBall() {
  ballX = canvas.width / 2;
  ballY = canvas.height - 40;
  ballSpeedX = 1;
  ballSpeedY = -1;
}

function showQuiz() {
  if (paused) return;
  paused = true;
  quizPopup.style.display = "block";
  const current = quizList[quizIndex % quizList.length];
  quizQuestion.innerText = current.q;
  quizIndex++;
  let time = 10;
  timerText.innerText = `ë‚¨ì€ ì‹œê°„: ${time}s`;
  quizTimer = setInterval(() => {
    time--;
    timerText.innerText = `ë‚¨ì€ ì‹œê°„: ${time}s`;
    if (time <= 0) { checkAnswer(null, current.a); }
  }, 1000);
  btnO.onclick = () => checkAnswer(true, current.a);
  btnX.onclick = () => checkAnswer(false, current.a);
}

function checkAnswer(answer, correct) {
  clearInterval(quizTimer);
  quizPopup.style.display = "none";
  let text = "";
  if (answer === correct) {
    score += 200;
    text = "ì •ë‹µì…ë‹ˆë‹¤!<br>+200ì ";
  } else {
    score -= 100;
    text = "ì˜¤ë‹µì…ë‹ˆë‹¤!<br>-100ì ";
  }
  resultPopup.innerHTML = text;
  resultPopup.style.display = "block";
  setTimeout(() => {
    resultPopup.style.display = "none";
    paused = false;
  }, 1500);
}

function endGame() {
  clearInterval(gameInterval);
  paused = true;
  gameOver.style.display = "block";
  finalText.innerHTML = `ê²Œì„ ì¢…ë£Œ!<br>ìµœì¢… ì ìˆ˜: ${score}<br>ë‚¨ì€ ë¼ì´í”„: ${lives}`;
}

startBtn.onclick = initGame;
restartBtn.onclick = () => {
  gameOver.style.display = "none";
  intro.style.display = "block";
};
</script>
</body>
</html>
