<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤ ì•„ì´ìŠ¤ë¸Œë ˆì´ì»¤ ğŸ®</title>
<style>
  body {
    margin: 0;
    background: radial-gradient(circle at 30% 30%, #04122a, #000);
    color: white;
    font-family: "Pretendard", sans-serif;
    overflow: hidden;
    touch-action: none;
  }
  canvas {
    display: block;
    margin: 0 auto;
    background: transparent;
  }
  #introOverlay, #quizOverlay, #gameOverOverlay {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,0.9);
    color: white;
    text-align: center;
  }
  #startButton {
    margin-top: 20px;
    padding: 12px 24px;
    font-size: 18px;
    border: none;
    border-radius: 12px;
    background-color: #00aaff;
    color: white;
    cursor: pointer;
  }
  #quizOverlay {
    display: none;
  }
  #quizQuestion {
    font-size: 20px;
    margin-bottom: 15px;
  }
  .quiz-button {
    font-size: 24px;
    padding: 10px 25px;
    margin: 0 10px;
    border-radius: 12px;
    border: none;
    cursor: pointer;
    background: #0077cc;
    color: white;
  }
  #quizTimer {
    margin-top: 10px;
    font-size: 18px;
  }
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>

<div id="introOverlay">
  <div style="font-size:22px; font-weight:bold; color:#00aaff; line-height:1.6;">
    ëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤<br>ì œê³µ<br>ì•„ì´ìŠ¤ë¸Œë ˆì´ì»¤
  </div>
  <button id="startButton">ê²Œì„ ì‹œì‘í•˜ê¸°</button>
</div>

<div id="quizOverlay">
  <div id="quizQuestion">í€´ì¦ˆê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
  <div>
    <button id="oButton" class="quiz-button">O</button>
    <button id="xButton" class="quiz-button">X</button>
  </div>
  <div id="quizTimer">ë‚¨ì€ ì‹œê°„: 10ì´ˆ</div>
</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let cw, ch;
function resizeCanvas() {
  cw = window.innerWidth;
  ch = window.innerHeight * 0.9;
  canvas.width = cw;
  canvas.height = ch;
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

// íŒ¨ë“¤
let paddleWidth = cw * 0.25;
let paddleHeight = 15;
let paddleX = (cw - paddleWidth) / 2;

// ê³µ
let ballRadius = 10;
let x = cw / 2;
let y = ch - 60;
let dx = 4; 
let dy = -4;

// ë²½ëŒ ì„¤ì •
const brickRowCount = 5;
const brickColumnCount = 7;
const brickWidth = 70;
const brickHeight = 20;
const brickPadding = 10;
const brickOffsetTop = 60;
const brickOffsetLeft = (cw - (brickColumnCount * (brickWidth + brickPadding) - brickPadding)) / 2;

let bricks = [];
function initBricks() {
  bricks = [];
  for (let c = 0; c < brickColumnCount; c++) {
    for (let r = 0; r < brickRowCount; r++) {
      let color = (r + c) % 2 === 0 ? "#ffaa00" : "#00aaff";
      bricks.push({ x: c*(brickWidth+brickPadding)+brickOffsetLeft, y: r*(brickHeight+brickPadding)+brickOffsetTop, status: 1, color });
    }
  }
}
initBricks();

let rightPressed = false, leftPressed = false;
let lives = 3, score = 0, quizActive = false;
let quizInterval, quizTimerInterval;
let gameRunning = false;

document.addEventListener("mousemove", mouseMoveHandler, false);
document.addEventListener("touchmove", touchMoveHandler, false);

function mouseMoveHandler(e) {
  let relativeX = e.clientX;
  if (relativeX > 0 && relativeX < cw) paddleX = relativeX - paddleWidth / 2;
}
function touchMoveHandler(e) {
  let touch = e.touches[0];
  let relativeX = touch.clientX;
  if (relativeX > 0 && relativeX < cw) paddleX = relativeX - paddleWidth / 2;
}

// === ê²Œì„ ë£¨í”„ ===
function drawBall() {
  ctx.beginPath();
  ctx.arc(x, y, ballRadius, 0, Math.PI*2);
  ctx.fillStyle = "#fff";
  ctx.fill();
  ctx.closePath();
}
function drawPaddle() {
  ctx.beginPath();
  ctx.rect(paddleX, ch - paddleHeight - 10, paddleWidth, paddleHeight);
  ctx.fillStyle = "#00aaff";
  ctx.fill();
  ctx.closePath();
}
function drawBricks() {
  for (let b of bricks) {
    if (b.status === 1) {
      ctx.beginPath();
      ctx.rect(b.x, b.y, brickWidth, brickHeight);
      ctx.fillStyle = b.color;
      ctx.fill();
      ctx.closePath();
    }
  }
}
function drawScore() {
  ctx.font = "16px Pretendard";
  ctx.fillText("ì ìˆ˜: " + score, 10, 20);
  ctx.fillText("ë¼ì´í”„: " + lives, cw - 100, 20);
}

function collisionDetection() {
  for (let b of bricks) {
    if (b.status === 1) {
      if (x > b.x && x < b.x + brickWidth && y > b.y && y < b.y + brickHeight) {
        dy = -dy;
        b.status = 0;
        score += 50;
      }
    }
  }
}

function draw() {
  if (!gameRunning || quizActive) return;
  ctx.clearRect(0, 0, cw, ch);
  drawBricks();
  drawBall();
  drawPaddle();
  drawScore();
  collisionDetection();

  if (x + dx > cw - ballRadius || x + dx < ballRadius) dx = -dx;
  if (y + dy < ballRadius) dy = -dy;
  else if (y + dy > ch - ballRadius - paddleHeight - 10) {
    if (x > paddleX && x < paddleX + paddleWidth) {
      dy = -dy;
    } else if (y + dy > ch) {
      lives--;
      if (!lives) { gameOver(); return; }
      else {
        x = cw / 2;
        y = ch - 60;
        dx = 4; dy = -4;
      }
    }
  }

  x += dx;
  y += dy;
  requestAnimationFrame(draw);
}

// === í€´ì¦ˆ ê´€ë ¨ ===
const quizOverlay = document.getElementById("quizOverlay");
const quizQuestion = document.getElementById("quizQuestion");
const oButton = document.getElementById("oButton");
const xButton = document.getElementById("xButton");
const quizTimer = document.getElementById("quizTimer");

const questions = [
  { q: "ëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤ëŠ” ë¥´ë…¸ì½”ë¦¬ì•„ì˜ ê³µì‹ ê¸ˆìœµ íŒŒíŠ¸ë„ˆì´ë‹¤.", a: true },
  { q: "ìë™ì°¨ í• ë¶€ê¸ˆìœµì€ ëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤ê°€ ì œê³µí•˜ì§€ ì•ŠëŠ”ë‹¤.", a: false },
  { q: "ëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤ëŠ” ê°œì¸ê³¼ ë²•ì¸ ê³ ê° ëª¨ë‘ì—ê²Œ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•œë‹¤.", a: true },
  { q: "ëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤ì˜ ë¸Œëœë“œ ìƒ‰ìƒì€ ë…¸ë€ìƒ‰ì´ë‹¤.", a: false },
  { q: "ë¥´ë…¸ì½”ë¦¬ì•„ ê³ ê°ì€ ëª¨ë¹Œë¼ì´ì¦ˆ ê¸ˆìœµìƒí’ˆì„ ì´ìš©í•  ìˆ˜ ìˆë‹¤.", a: true }
];

function showQuiz() {
  if (!gameRunning) return;
  quizActive = true;
  let q = questions[Math.floor(Math.random() * questions.length)];
  quizQuestion.innerText = q.q;
  quizOverlay.style.display = "flex";
  let timeLeft = 10;
  quizTimer.innerText = "ë‚¨ì€ ì‹œê°„: " + timeLeft + "ì´ˆ";

  quizTimerInterval = setInterval(() => {
    timeLeft--;
    quizTimer.innerText = "ë‚¨ì€ ì‹œê°„: " + timeLeft + "ì´ˆ";
    if (timeLeft <= 0) {
      clearInterval(quizTimerInterval);
      handleAnswer(false);
    }
  }, 1000);

  oButton.onclick = () => handleAnswer(true === q.a);
  xButton.onclick = () => handleAnswer(false === q.a);
}

function handleAnswer(correct) {
  clearInterval(quizTimerInterval);
  quizOverlay.style.display = "none";
  let msg = document.createElement("div");
  msg.style.position = "absolute";
  msg.style.top = "50%";
  msg.style.left = "50%";
  msg.style.transform = "translate(-50%, -50%)";
  msg.style.fontSize = "24px";
  msg.style.fontWeight = "bold";
  msg.style.color = "white";
  msg.innerText = correct ? "ì •ë‹µì…ë‹ˆë‹¤! +200ì " : "ì˜¤ë‹µì…ë‹ˆë‹¤! -100ì ";
  document.body.appendChild(msg);
  score += correct ? 200 : -100;

  setTimeout(() => {
    msg.remove();
    quizActive = false;
    quizOverlay.style.display = "none";
    draw();
  }, 1500);
}

// === ê²Œì„ ì˜¤ë²„ ===
function gameOver() {
  gameRunning = false;
  const over = document.createElement("div");
  over.id = "gameOverOverlay";
  over.innerHTML = `
    <div>ê²Œì„ ì¢…ë£Œ!</div>
    <div style="margin-top:10px;">ìµœì¢… ì ìˆ˜: ${score}</div>
    <div style="margin-top:5px;">ë‚¨ì€ ë¼ì´í”„: ${lives}</div>
    <div style="margin-top:20px; font-size:18px; opacity:0.8;">í™”ë©´ì„ í„°ì¹˜í•˜ë©´ ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.</div>
  `;
  document.body.appendChild(over);

  over.addEventListener("click", () => {
    over.remove();
    showIntro();
  });
}

// === ì¸íŠ¸ë¡œ ë° ì‹œì‘ ===
const introOverlay = document.getElementById("introOverlay");
const startButton = document.getElementById("startButton");

startButton.addEventListener("click", startGame);

function showIntro() {
  introOverlay.style.display = "flex";
  introOverlay.innerHTML = `
    <div style="font-size:22px; font-weight:bold; color:#00aaff; line-height:1.6;">
      ëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤<br>ì œê³µ<br>ì•„ì´ìŠ¤ë¸Œë ˆì´ì»¤
    </div>
    <button id="startButton">ê²Œì„ ì‹œì‘í•˜ê¸°</button>
  `;
  document.getElementById("startButton").addEventListener("click", startGame);
}

function startGame() {
  introOverlay.style.display = "none";
  initBricks();
  x = cw / 2;
  y = ch - 60;
  dx = 4; dy = -4;
  lives = 3; score = 0;
  gameRunning = true;
  draw();

  clearInterval(quizInterval);
  quizInterval = setInterval(showQuiz, 10000);
}
</script>
</body>
</html>
