<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
<title>ëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤ì½”ë¦¬ì•„ "ì•„ì´ìŠ¤ ë¸Œë ˆì´ì»¤"</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: radial-gradient(circle at center, #041630, #000);
    color: white;
    font-family: "Pretendard", sans-serif;
    touch-action: none;
  }
  #gameContainer {
    position: relative;
    width: 100%;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  canvas {
    border: 3px solid #39aaff;
    border-radius: 15px;
    background: radial-gradient(circle at 30% 30%, #062047, #000);
    box-shadow: 0 0 20px #009dff;
    touch-action: none;
  }
  #scoreBoard {
    position: absolute;
    top: 10px;
    right: 10px;
    font-size: 16px;
    background: rgba(0,0,0,0.5);
    padding: 6px 12px;
    border-radius: 10px;
  }
  #intro {
    position: absolute;
    inset: 0;
    background: black;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    color: #39aaff;
    font-size: 1.6rem;
    line-height: 2.5rem;
    font-weight: bold;
    z-index: 5;
  }
  #startBtn {
    margin-top: 30px;
    background: #00bfff;
    color: white;
    border: none;
    border-radius: 10px;
    padding: 12px 24px;
    font-size: 1.1rem;
    cursor: pointer;
  }
  #quiz {
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.85);
    color: white;
    display: none;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    z-index: 6;
    padding: 0 20px;
  }
  #quiz h2 {
    font-size: 1.3rem;
    margin-bottom: 1.2rem;
    line-height: 1.6rem;
    word-break: keep-all;
    white-space: pre-line;
  }
  .quiz-btn-container {
    display: flex;
    gap: 20px;
    justify-content: center;
  }
  .quiz-btn {
    background: #00bfff;
    color: white;
    border: none;
    border-radius: 10px;
    padding: 10px 30px;
    font-size: 1.2rem;
    cursor: pointer;
  }
  #timer {
    font-size: 1rem;
    margin-top: 10px;
    color: #ff6666;
  }
  #resultMsg, #lifeMsg {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 1.4rem; 
    font-weight: bold;
    background: rgba(0,0,0,0.7);
    padding: 15px 25px; 
    border-radius: 12px;
    display: none;
    z-index: 8;
    text-align: center;
    white-space: pre-line;
  }
  #finalResult {
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.9);
    color: #39aaff;
    display: none;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    font-size: 1.5rem;
    z-index: 7;
    text-align: center;
  }
  #retryBtn {
    margin-top: 20px;
    background: #00bfff;
    color: white;
    border: none;
    border-radius: 10px;
    padding: 12px 24px;
    font-size: 1.1rem;
    cursor: pointer;
  }
</style>
</head>
<body>
  <div id="gameContainer">
    <div id="intro">
      <div>ëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤</div>
      <div>ì œê³µ</div>
      <div>"ì•„ì´ìŠ¤ ë¸Œë ˆì´ì»¤"</div>
      <button id="startBtn" style="display:none;" onclick="startGame()">ê²Œì„ ì‹œì‘í•˜ê¸°</button>
    </div>

    <div id="quiz">
      <h2 id="questionText"></h2>
      <div class="quiz-btn-container">
        <button class="quiz-btn" onclick="answerQuiz(true)">O</button>
        <button class="quiz-btn" onclick="answerQuiz(false)">X</button>
      </div>
      <div id="timer"></div>
    </div>

    <canvas id="gameCanvas"></canvas>
    <div id="scoreBoard">ì ìˆ˜: 0 | ë¼ì´í”„: 3</div>
    <div id="resultMsg"></div>
    <div id="lifeMsg"></div>

    <div id="finalResult">
      <div id="finalText"></div>
      <button id="retryBtn" onclick="returnToIntro()">ë‹¤ì‹œ ë„ì „í•˜ê¸°</button>
    </div>
  </div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
let width = window.innerWidth * 0.9;
let height = window.innerHeight * 0.6;
canvas.width = width;
canvas.height = height;

window.addEventListener("resize", () => {
  width = window.innerWidth * 0.9;
  height = window.innerHeight * 0.6;
  canvas.width = width;
  canvas.height = height;
});

// ê³µì˜ ì†ë„ ê´€ë ¨ ë³€ìˆ˜ì™€ ì œí•œ ì„¤ì •
const SPEED_CHANGE = 0.1;
const MAX_SPEED = 3.0;
const MIN_SPEED = 1.0; 
const NUM_BOMBS = 3; // ì¶”ê°€ëœ í­íƒ„ ë²½ëŒ ê°œìˆ˜

let ball = { x: width / 2, y: height - 30, dx: 1, dy: -1, r: 8 };
let paddle = { w: 80, h: 10, x: width / 2 - 40 };
let bricks = [];
let score = 0, lives = 3;
let gameRunning = false;
let quizActive = false;
let quizTimer, timeLeft = 10;
let quizInterval;
let pausedForResult = false;

const quizBox = document.getElementById("quiz");
const questionText = document.getElementById("questionText");
const timerDisplay = document.getElementById("timer");
const resultMsg = document.getElementById("resultMsg");
const lifeMsg = document.getElementById("lifeMsg");

// ì´ 22ê°œì˜ í€´ì¦ˆ ëª©ë¡ (ì´ì „ ìš”ì²­ì—ì„œ 20ê°œ ìš”ì²­í–ˆëŠ”ë° 22ê°œë¡œ êµ¬ì„±ë˜ì–´ìˆì–´ ê·¸ëŒ€ë¡œ ìœ ì§€í•©ë‹ˆë‹¤.)
const allQuizzes = [
  { q: "ê·¸ë‘ì½œë ˆì˜¤ìŠ¤ 26ë…„ ìƒì‚°ê¸°ì¤€\n3.3% ê¸ˆë¦¬ í• ë¶€ì›ê¸ˆì œí•œì€\n2500ë§Œì› ìˆë‹¤?", a: true },
  { q: "ëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤ëŠ”\ní”„ë‘ìŠ¤ íšŒì‚¬ë‹¤?", a: true },
  { q: "ì”ê°€ë³´ì¥ìƒí’ˆì€\nëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤ì—ë§Œ ìˆëŠ”\ní• ë¶€ìƒí’ˆì´ë‹¤?", a: false },
  { q: "ëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤ì˜ ê³µì‹ ê¸ˆìœµ íŒŒíŠ¸ë„ˆëŠ”\në¥´ë…¸ê·¸ë£¹ì´ë‹¤?", a: true },
  { q: "ëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤ ì½”ë¦¬ì•„ì˜\nëŒ€í‘œ ê³ ê°ì„¼í„° ë²ˆí˜¸ëŠ” 1588-2114ì´ë‹¤?", a: false },
  { q: "ëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤ ì½”ë¦¬ì•„ëŠ”\ní• ë¶€, ë¦¬ìŠ¤, ì¤‘ê³ ì°¨ ì‚¬ì—… ë¶„ì•¼ì— ê±¸ì¹œ\nì¢…í•© ê¸ˆìœµ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•œë‹¤?", a: true },
  { q: "ëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤ ì½”ë¦¬ì•„ëŠ”\në¥´ë…¸ì½”ë¦¬ì•„ìë™ì°¨ì˜ ê¸ˆìœµ íŒŒíŠ¸ë„ˆë¡œ,\n2023ë…„ í•œêµ­ ì§„ì¶œ 20ì£¼ë…„ì„ ë§ì´í–ˆë‹¤?", a: true },
  { q: "ëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤ì˜ ì´ì „ ì‚¬ëª…ì€\n'ë¥´ë…¸íŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤ì½”ë¦¬ì•„'ì˜€ë‹¤?", a: true },
  { q: "ëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤ ì½”ë¦¬ì•„ì˜\në³¸ì‚¬ ì£¼ì†ŒëŠ” ì„œìš¸ì‹œ ì¤‘êµ¬ í•œê°•ëŒ€ë¡œ 416\nì„œìš¸ìŠ¤í€˜ì–´ì— ìˆë‹¤?", a: true },
  { q: "ëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤ì˜ ê¸ˆìœµìƒí’ˆ ì¤‘\nì‹ ì°¨í• ë¶€ëŠ” ì—†ë‹¤?", a: false },
  { q: "ëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤ ë³¸ì‚¬ì¸\ní”„ë‘ìŠ¤ RCIë±…í¬ì•¤ì„œë¹„ìŠ¤ëŠ”\n2022ë…„ 5ì›”ì— ì‚¬ëª…ì„ ë³€ê²½í–ˆë‹¤?", a: true },
  { q: "ëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤ëŠ” ì „ ì„¸ê³„ì ìœ¼ë¡œ\në¥´ë…¸Â·ë‹›ì‚°Â·ë¯¸ì“°ë¹„ì‹œ ê³ ê°ì—ê²Œ\nê¸ˆìœµ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•œë‹¤?", a: true },
  { q: "ëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤ì˜ ìƒí’ˆ ì¤‘\nìš´ìš©ë¦¬ìŠ¤(Lease)ë¥¼ ì´ìš©í•˜ë©´\nì¥ê¸°ë ŒíŠ¸ì™€ ê°™ì´ 'í•˜', 'í—ˆ', 'í˜¸' ë²ˆí˜¸íŒì„ ì‚¬ìš©í•˜ê²Œ ëœë‹¤?", a: false },
  { q: "ìš´ìš©ë¦¬ìŠ¤ì˜ ê³„ì•½ ë§Œê¸° ì‹œ ì°¨ëŸ‰ ë°˜ë‚©, ì´ìš© ê¸°ê°„ ì—°ì¥,\nì°¨ëŸ‰ êµ¬ë§¤ ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•  ìˆ˜ ìˆë‹¤?", a: true },
  { q: "ì¤‘ê³ ì°¨ ì˜¤í† ë¡ ì˜ ëŒ€ì¶œ ìµœê³  ê¸ˆë¦¬ëŠ”\nì—° 18%ì´ë‹¤?", a: true },
  { q: "ëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤ëŠ” ê³ ê°ì—ê²Œ\nì°¨ëŸ‰ìœ ì§€ ë° ê´€ë¦¬ì— ë„ì›€ì´ ë˜ëŠ”\nì œíœ´ ë³´í—˜ ì„œë¹„ìŠ¤ ìƒí’ˆë„ ì œê³µí•œë‹¤?", a: true },
  { q: "ëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤ì˜ ëª¨ë°”ì¼ ì•±ì€\ní• ë¶€ê¸ˆìœµì´ í•„ìš”í•œ ê³ ê°ì—ê²Œ\në””ì§€í„¸ í• ë¶€ ê¸ˆìœµ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•œë‹¤?", a: true },
  { q: "ëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤ ì½”ë¦¬ì•„ì˜\nì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ëŠ” 104-81-79808ì´ë‹¤?", a: true },
  { q: "ëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤ ì½”ë¦¬ì•„ëŠ”\n2003ë…„ì— êµ­ë‚´ ë²•ì¸ì´ ì„¤ë¦½ë˜ì—ˆë‹¤?", a: true },
  { q: "ë¦¬ìŠ¤ ìƒí’ˆ ì¤‘ ê¸ˆìœµë¦¬ìŠ¤ëŠ” ìš´ìš©ë¦¬ìŠ¤ì™€ ë‹¬ë¦¬\nê³„ì•½ ë§Œê¸° ì‹œ ì°¨ëŸ‰ ë°˜ë‚©ì´ ë¶ˆê°€ëŠ¥í•˜ë‹¤?", a: true },
  { q: "ëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤ ì½”ë¦¬ì•„ì˜ ëŒ€í‘œëŠ”\nAlex ZHURKIN (ì•Œë ‰ìŠ¤ ì¥¬ë¥´í‚¨)ì´ë‹¤?", a: false },
  { q: "ëª¨ë¹Œë¼ì´ì¦ˆíŒŒì´ë‚¸ì…œì„œë¹„ìŠ¤ì˜ ë³¸ì‚¬ ìœ„ì¹˜ëŠ”\ní”„ë‘ìŠ¤ íŒŒë¦¬ì´ë‹¤?", a: true }
];

let availableQuizIndices = []; // ë‚¨ì•„ìˆëŠ” í€´ì¦ˆ ì¸ë±ìŠ¤

function resetQuizAvailability() {
    availableQuizIndices = [...Array(allQuizzes.length).keys()];
    for (let i = availableQuizIndices.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [availableQuizIndices[i], availableQuizIndices[j]] = [availableQuizIndices[j], availableQuizIndices[i]];
    }
}

canvas.addEventListener("touchmove", e => {
  const touch = e.touches[0];
  const rect = canvas.getBoundingClientRect();
  paddle.x = touch.clientX - rect.left - paddle.w / 2;
});
canvas.addEventListener("mousemove", e => {
  const rect = canvas.getBoundingClientRect();
  paddle.x = e.clientX - rect.left - paddle.w / 2;
});

function createLogoBricks() {
  const brickW = 40, brickH = 16;
  const brickGap = 4;
  const cx = width / 2, cy = height / 3;
  const outer = 160, inner = 90;
  bricks = [];
  const allBrickPositions = []; // í­íƒ„ ë²½ëŒ ì„ ì •ì„ ìœ„í•œ ëª¨ë“  ìœ íš¨ ë²½ëŒ ìœ„ì¹˜ ì €ì¥

  // 1. ëª¨ë“  ë²½ëŒ ìƒì„± (í­íƒ„ ì—¬ë¶€ ì œì™¸)
  for (let y = 40; y < height / 1.5; y += brickH + brickGap) {
    for (let x = 40; x < width - 40; x += brickW + brickGap) {
      const dx = x - cx, dy = y - cy;
      const dist = Math.sqrt(dx * dx + dy * dy);
      const angle = Math.atan2(dy, dx);
      const circlePart = dist < outer && dist > inner && (angle < -0.5 || angle > 0.5);
      const slash = Math.abs(dy + dx * 0.5) < 20;
      
      if (circlePart || slash) {
        const newBrick = {
          x, y, w: brickW, h: brickH, 
          color: slash ? "#ff3c00" : "#39aaff", 
          visible: true, 
          isBomb: false, 
          bombHits: 0, 
          row: Math.floor((y - 40) / (brickH + brickGap)),
          col: Math.floor((x - 40) / (brickW + brickGap))
        };
        bricks.push(newBrick);
        allBrickPositions.push(bricks.length - 1);
      }
    }
  }

  // 2. í­íƒ„ ë²½ëŒ ë¬´ì‘ìœ„ ì„ ì •
  const bombIndices = [];
  while (bombIndices.length < NUM_BOMBS && allBrickPositions.length > 0) {
    const randomIndexInPos = Math.floor(Math.random() * allBrickPositions.length);
    const brickIndex = allBrickPositions.splice(randomIndexInPos, 1)[0];
    
    // í­íƒ„ ì†ì„± ì¶”ê°€
    bricks[brickIndex].isBomb = true;
    bricks[brickIndex].bombHits = 3;
    bombIndices.push(brickIndex);
  }
}

function drawBricks() {
  bricks.forEach(b => {
    if (!b.visible) return;
    
    ctx.shadowBlur = 10;
    ctx.shadowColor = b.color;
    
    if (b.isBomb) {
        // í­íƒ„ ë²½ëŒ (ë¹¨ê°„ í…Œë‘ë¦¬, ë…¸ë€ ì¤‘ì•™)
        ctx.fillStyle = '#ff4444'; // ë¹¨ê°„ í…Œë‘ë¦¬
        ctx.fillRect(b.x, b.y, b.w, b.h);
        ctx.fillStyle = b.bombHits === 3 ? '#ffff00' : 
                        b.bombHits === 2 ? '#ffcc00' :
                        '#ff9900'; // ë…¸ë€ ì¤‘ì•™ (ë‚¨ì€ íšŸìˆ˜ì— ë”°ë¼ ìƒ‰ìƒ ë³€í™”)
        ctx.fillRect(b.x + 2, b.y + 2, b.w - 4, b.h - 4);

        // ë‚¨ì€ íšŸìˆ˜ í‘œì‹œ
        ctx.fillStyle = 'black';
        ctx.font = '10px Arial';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(b.bombHits, b.x + b.w / 2, b.y + b.h / 2);
    } else {
        // ì¼ë°˜ ë²½ëŒ
        ctx.fillStyle = b.color;
        ctx.fillRect(b.x, b.y, b.w, b.h);
    }
  });
  ctx.shadowBlur = 0;
}

// í­íƒ„ ë²½ëŒ í­ë°œ ë¡œì§
function explodeBomb(bombBrick) {
    const explosionScore = 10;
    const { row: targetRow, col: targetCol } = bombBrick;
    
    // í­íƒ„ ë²½ëŒ í¬í•¨í•˜ì—¬ ì œê±°í•  ë²½ëŒ ìœ„ì¹˜
    const positionsToClear = [];
    for (let dr = -1; dr <= 1; dr++) {
        for (let dc = -1; dc <= 1; dc++) {
            positionsToClear.push({ row: targetRow + dr, col: targetCol + dc });
        }
    }

    // ë²½ëŒ ëª©ë¡ì„ ìˆœíšŒí•˜ë©° í­ë°œ ë²”ìœ„ ë‚´ì˜ ë²½ëŒ ì œê±°
    bricks.forEach(brick => {
        if (!brick.visible) return;
        
        const isNear = positionsToClear.some(pos => pos.row === brick.row && pos.col === brick.col);
        
        if (isNear) {
            brick.visible = false;
            score += explosionScore; // í­ë°œë¡œ ì œê±°ëœ ë²½ëŒ ë‹¹ ì ìˆ˜ ì¶”ê°€
        }
    });

    // í­ë°œ ë©”ì‹œì§€ í‘œì‹œ (ì˜µì…˜)
    // showResultMessage("BOMB! ì£¼ë³€ 9ê°œ ë²½ëŒ íŒŒê´´!", "#ff0000"); 
    updateScore();
}

function drawBall() {
  ctx.beginPath();
  ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI * 2);
  ctx.fillStyle = "#fff";
  ctx.shadowBlur = 15;
  ctx.shadowColor = "#00ffff";
  ctx.fill();
  ctx.closePath();
  ctx.shadowBlur = 0;
}

function drawPaddle() {
  ctx.fillStyle = "#00ccff";
  ctx.fillRect(paddle.x, height - 30, paddle.w, paddle.h);
}

function draw() {
  ctx.clearRect(0, 0, width, height);
  drawBricks();
  drawBall();
  drawPaddle();
}

function update() {
  if (!gameRunning || quizActive || pausedForResult) return;
  ball.x += ball.dx;
  ball.y += ball.dy;

  if (ball.x + ball.r > width || ball.x - ball.r < 0) ball.dx *= -1;
  if (ball.y - ball.r < 0) ball.dy *= -1;

  if (ball.y + ball.r > height - 30 && ball.x > paddle.x && ball.x < paddle.x + paddle.w) {
    ball.dy = -Math.abs(ball.dy);
  }

  bricks.forEach(b => {
    if (b.visible &&
        ball.x > b.x && ball.x < b.x + b.w &&
        ball.y > b.y && ball.y < b.y + b.h) {
      
      // í­íƒ„ ë²½ëŒ ì²˜ë¦¬
      if (b.isBomb) {
        b.bombHits--;
        if (b.bombHits <= 0) {
            explodeBomb(b); // í­íƒ„ í­ë°œ!
        }
      } else {
        // ì¼ë°˜ ë²½ëŒ ì²˜ë¦¬
        b.visible = false;
        score += 10;
        updateScore();
      }
      
      ball.dy *= -1; // ë²½ëŒì„ ë§ì¶”ë©´ ê³µ ë°˜ì‚¬
    }
  });

  if (ball.y > height) {
    lives--;
    updateScore();
    if (lives <= 0) {
      endGame();
      return;
    } else {
      showLifeMessage(`ë¼ì´í”„ê°€ 1 ê°ì†Œí–ˆìŠµë‹ˆë‹¤.\n\në‚¨ì€ ë¼ì´í”„: ${lives}`);
      ball = { x: width / 2, y: height - 40, dx: Math.abs(ball.dx), dy: -Math.abs(ball.dy), r: 8 };
    }
  }
  draw();
  requestAnimationFrame(update);
}

function updateScore() {
  document.getElementById("scoreBoard").textContent = `ì ìˆ˜: ${score} | ë¼ì´í”„: ${lives}`;
}

function startQuiz() {
  if (!gameRunning) return;
  quizActive = true;
  gameRunning = false;
  
  if (availableQuizIndices.length === 0) {
      resetQuizAvailability(); 
  }
  const randomIndexInAvailable = Math.floor(Math.random() * availableQuizIndices.length);
  const quizIndex = availableQuizIndices.splice(randomIndexInAvailable, 1)[0];
  const q = allQuizzes[quizIndex];
  
  questionText.textContent = q.q;
  quizBox.style.display = "flex";
  timeLeft = 10;
  timerDisplay.textContent = `ë‚¨ì€ ì‹œê°„: ${timeLeft}s`;
  quizTimer = setInterval(() => {
    timeLeft--;
    timerDisplay.textContent = `ë‚¨ì€ ì‹œê°„: ${timeLeft}s`;
    if (timeLeft <= 0) {
      clearInterval(quizTimer);
      checkAnswer(false, q.a);
    }
  }, 1000);
  quizBox.dataset.answer = q.a;
}

function stopQuizTimer() {
  if (quizTimer) clearInterval(quizTimer);
}

// ğŸ¯ ê³µ ì†ë„ ì¡°ì ˆ ë¡œì§ í•¨ìˆ˜
function adjustBallSpeed(isCorrect) {
    let speed = Math.abs(ball.dx);
    
    if (isCorrect) {
        speed = Math.max(MIN_SPEED, speed - SPEED_CHANGE); // ì •ë‹µ: ì†ë„ ê°ì†Œ (ìµœì†Œ ì†ë„ 1.0)
    } else {
        speed = Math.min(MAX_SPEED, speed + SPEED_CHANGE); // ì˜¤ë‹µ: ì†ë„ ì¦ê°€ (ìµœëŒ€ ì†ë„ 3.0)
    }
    
    // dx, dy ë°©í–¥ì€ ìœ ì§€í•˜ê³  í¬ê¸°(speed)ë§Œ ë³€ê²½
    ball.dx = ball.dx > 0 ? speed : -speed;
    ball.dy = ball.dy > 0 ? speed : -speed;
}

function answerQuiz(ans) {
  stopQuizTimer();
  const correct = quizBox.dataset.answer === "true";
  checkAnswer(ans, correct);
}

function showResultMessage(text, color) {
  resultMsg.textContent = text;
  resultMsg.style.color = color;
  resultMsg.style.display = "block";
  pausedForResult = true;
  setTimeout(() => {
    resultMsg.style.display = "none";
    pausedForResult = false;
    gameRunning = true;
    update();
  }, 1500);
}

function showLifeMessage(text) {
  pausedForResult = true;
  lifeMsg.textContent = text;
  lifeMsg.style.display = "block";
  setTimeout(() => {
    lifeMsg.style.display = "none";
    pausedForResult = false;
    gameRunning = true;
    update();
  }, 1500);
}

function checkAnswer(selected, correct) {
  quizBox.style.display = "none";
  quizActive = false;
  
  // ğŸ¯ í€´ì¦ˆ ê²°ê³¼ì— ë”°ë¥¸ ê³µ ì†ë„ ì¡°ì ˆ
  adjustBallSpeed(selected === correct);

  if (selected === correct) {
    score += 200;
    showResultMessage("ì •ë‹µì…ë‹ˆë‹¤!\n\n+200ì ", "#00ff88");
  } else {
    score -= 100;
    lives--;
    showResultMessage("ì˜¤ë‹µì…ë‹ˆë‹¤!\n\n-100ì ", "#ff5555");
  }
  updateScore();
  if (lives <= 0) endGame();
}

function startQuizCycle() {
  quizInterval = setInterval(() => {
    if (gameRunning && !quizActive && !pausedForResult) startQuiz();
  }, 10000);
}

function stopQuizCycle() {
  if (quizInterval) clearInterval(quizInterval);
}

function resetGame() {
  score = 0;
  lives = 3;
  createLogoBricks();
  updateScore();
  // ë¦¬ì…‹ ì‹œ ê³µ ì†ë„ëŠ” 1.0ìœ¼ë¡œ ì´ˆê¸°í™”
  ball = { x: width / 2, y: height - 40, dx: 1.0, dy: -1.0, r: 8 }; 
  resetQuizAvailability(); 
}

function endGame() {
  stopQuizTimer();
  stopQuizCycle();
  gameRunning = false;
  quizActive = false;
  pausedForResult = false;
  
  document.getElementById("finalText").innerHTML = `ê²Œì„ ì¢…ë£Œ! <br><br> ìµœì¢… ì ìˆ˜: ${score} <br><br> ë‚¨ì€ ë¼ì´í”„: ${lives}`;
  
  document.getElementById("finalResult").style.display = "flex";
}

function returnToIntro() {
  document.getElementById("finalResult").style.display = "none";
  resetGame();
  document.getElementById("intro").style.display = "flex";
  document.getElementById("startBtn").style.display = "block";
}

createLogoBricks();
resetQuizAvailability();
setTimeout(() => {
  document.getElementById("startBtn").style.display = "block";
}, 3000);

function startGame() {
  document.getElementById("intro").style.display = "none";
  document.getElementById("finalResult").style.display = "none";
  resetGame();
  gameRunning = true;
  startQuizCycle();
  update();
}
</script>
</body>
</html>
