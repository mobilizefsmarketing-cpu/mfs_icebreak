<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
<title>모빌라이즈파이낸셜서비스코리아 "아이스 브레이커"</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: radial-gradient(circle at center, #041630, #000);
    color: white;
    font-family: "Pretendard", sans-serif;
    touch-action: none;
  }
  #gameContainer {
    position: relative;
    width: 100%;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  canvas {
    border: 3px solid #39aaff;
    border-radius: 15px;
    background: radial-gradient(circle at 30% 30%, #062047, #000);
    box-shadow: 0 0 20px #009dff;
    touch-action: none;
  }
  #scoreBoard {
    position: absolute;
    top: 10px;
    right: 10px;
    font-size: 16px;
    background: rgba(0,0,0,0.5);
    padding: 6px 12px;
    border-radius: 10px;
  }
  #intro {
    position: absolute;
    inset: 0;
    background: black;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    color: #39aaff;
    font-size: 1.6rem;
    line-height: 2.5rem;
    font-weight: bold;
    z-index: 5;
  }
  #startBtn {
    margin-top: 30px;
    background: #00bfff;
    color: white;
    border: none;
    border-radius: 10px;
    padding: 12px 24px;
    font-size: 1.1rem;
    cursor: pointer;
  }
  #quiz {
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.85);
    color: white;
    display: none;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    z-index: 6;
    padding: 0 20px;
  }
  #quiz h2 {
    font-size: 1.3rem;
    margin-bottom: 1.2rem;
    line-height: 1.6rem;
    word-break: keep-all;
    white-space: pre-line;
  }
  .quiz-btn-container {
    display: flex;
    gap: 20px;
    justify-content: center;
  }
  .quiz-btn {
    background: #00bfff;
    color: white;
    border: none;
    border-radius: 10px;
    padding: 10px 30px;
    font-size: 1.2rem;
    cursor: pointer;
  }
  #timer {
    font-size: 1rem;
    margin-top: 10px;
    color: #ff6666;
  }
  #resultMsg, #lifeMsg {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 1.4rem; 
    font-weight: bold;
    background: rgba(0,0,0,0.7);
    padding: 15px 25px; 
    border-radius: 12px;
    display: none;
    z-index: 8;
    text-align: center;
    white-space: pre-line;
  }
  #finalResult {
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.9);
    color: #39aaff;
    display: none;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    font-size: 1.5rem;
    z-index: 7;
    text-align: center;
  }
  #retryBtn {
    margin-top: 20px;
    background: #00bfff;
    color: white;
    border: none;
    border-radius: 10px;
    padding: 12px 24px;
    font-size: 1.1rem;
    cursor: pointer;
  }
</style>
</head>
<body>
  <div id="gameContainer">
    <audio id="bgm" loop preload="auto">
        </audio>
    <audio id="bounceSfx" preload="auto">
        </audio>
    <audio id="clickSfx" preload="auto">
        </audio>

    <div id="intro">
      <div>모빌라이즈파이낸셜서비스</div>
      <div>제공</div>
      <div>"아이스 브레이커"</div>
      <button id="startBtn" style="display:none;" onclick="startGame()">게임 시작하기</button>
    </div>

    <div id="quiz">
      <h2 id="questionText"></h2>
      <div class="quiz-btn-container">
        <button class="quiz-btn" onclick="answerQuiz(true)">O</button>
        <button class="quiz-btn" onclick="answerQuiz(false)">X</button>
      </div>
      <div id="timer"></div>
    </div>

    <canvas id="gameCanvas"></canvas>
    <div id="scoreBoard">점수: 0 | 라이프: 3</div>
    <div id="resultMsg"></div>
    <div id="lifeMsg"></div>

    <div id="finalResult">
      <div id="finalText"></div>
      <button id="retryBtn" onclick="returnToIntro()">다시 도전하기</button>
    </div>
  </div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
let width = window.innerWidth * 0.9;
let height = window.innerHeight * 0.6;
canvas.width = width;
canvas.height = height;

window.addEventListener("resize", () => {
  width = window.innerWidth * 0.9;
  height = window.innerHeight * 0.6;
  canvas.width = width;
  canvas.height = height;
});

// 오디오 요소
const bgm = document.getElementById('bgm');
const bounceSfx = document.getElementById('bounceSfx');
const clickSfx = document.getElementById('clickSfx');

// 볼륨 설정
bgm.volume = 0.2; // 배경음은 작게
bounceSfx.volume = 0.5; // 효과음
clickSfx.volume = 0.6; // 효과음

function playSfx(audioElement) {
    audioElement.currentTime = 0; // 소리가 겹쳐 재생될 수 있도록 현재 재생 위치를 0으로 리셋
    audioElement.play().catch(e => console.log("Audio playback failed:", e));
}

// 공의 속도 관련 변수와 제한 설정
const SPEED_CHANGE = 0.1;
const MAX_SPEED = 3.0;
const MIN_SPEED = 1.0; 
const NUM_BOMBS = 3; 

let ball = { x: width / 2, y: height - 30, dx: 1, dy: -1, r: 8 };
let paddle = { w: 80, h: 10, x: width / 2 - 40 };
let bricks = [];
let score = 0, lives = 3;
let gameRunning = false;
let quizActive = false;
let quizTimer, timeLeft = 10;
let quizInterval;
let pausedForResult = false;

const quizBox = document.getElementById("quiz");
const questionText = document.getElementById("questionText");
const timerDisplay = document.getElementById("timer");
const resultMsg = document.getElementById("resultMsg");
const lifeMsg = document.getElementById("lifeMsg");

// 총 22개의 퀴즈 목록
const allQuizzes = [
  { q: "그랑콜레오스 26년 생산기준\n3.3% 금리 할부원금제한은\n2500만원 있다?", a: true },
  { q: "모빌라이즈파이낸셜서비스는\n프랑스 회사다?", a: true },
  { q: "잔가보장상품은\n모빌라이즈파이낸셜서비스에만 있는\n할부상품이다?", a: false },
  { q: "모빌라이즈파이낸셜서비스의 공식 금융 파트너는\n르노그룹이다?", a: true },
  { q: "모빌라이즈파이낸셜서비스 코리아의\n대표 고객센터 번호는 1588-2114이다?", a: false },
  { q: "모빌라이즈파이낸셜서비스 코리아는\n할부, 리스, 중고차 사업 분야에 걸친\n종합 금융 서비스를 제공한다?", a: true },
  { q: "모빌라이즈파이낸셜서비스 코리아는\n르노코리아자동차의 금융 파트너로,\n2023년 한국 진출 20주년을 맞이했다?", a: true },
  { q: "모빌라이즈파이낸셜서비스의 이전 사명은\n'르노파이낸셜서비스코리아'였다?", a: true },
  { q: "모빌라이즈파이낸셜서비스 코리아의\n본사 주소는 서울시 중구 한강대로 416\n서울스퀘어에 있다?", a: true },
  { q: "모빌라이즈파이낸셜서비스의 금융상품 중\n신차할부는 없다?", a: false },
  { q: "모빌라이즈파이낸셜서비스 본사인\n프랑스 RCI뱅크앤서비스는\n2022년 5월에 사명을 변경했다?", a: true },
  { q: "모빌라이즈파이낸셜서비스는 전 세계적으로\n르노·닛산·미쓰비시 고객에게\n금융 서비스를 제공한다?", a: true },
  { q: "모빌라이즈파이낸셜서비스의 상품 중\n운용리스(Lease)를 이용하면\n장기렌트와 같이 '하', '허', '호' 번호판을 사용하게 된다?", a: false },
  { q: "운용리스의 계약 만기 시 차량 반납, 이용 기간 연장,\n차량 구매 중 하나를 선택할 수 있다?", a: true },
  { q: "중고차 오토론의 대출 최고 금리는\n연 18%이다?", a: true },
  { q: "모빌라이즈파이낸셜서비스는 고객에게\n차량유지 및 관리에 도움이 되는\n제휴 보험 서비스 상품도 제공한다?", a: true },
  { q: "모빌라이즈파이낸셜서비스의 모바일 앱은\n할부금융이 필요한 고객에게\n디지털 할부 금융 서비스를 제공한다?", a: true },
  { q: "모빌라이즈파이낸셜서비스 코리아의\n사업자등록번호는 104-81-79808이다?", a: true },
  { q: "모빌라이즈파이낸셜서비스 코리아는\n2003년에 국내 법인이 설립되었다?", a: true },
  { q: "리스 상품 중 금융리스는 운용리스와 달리\n계약 만기 시 차량 반납이 불가능하다?", a: true },
  { q: "모빌라이즈파이낸셜서비스 코리아의 대표는\nAlex ZHURKIN (알렉스 쥬르킨)이다?", a: false },
  { q: "모빌라이즈파이낸셜서비스의 본사 위치는\n프랑스 파리이다?", a: true }
];

let availableQuizIndices = []; // 남아있는 퀴즈 인덱스

function resetQuizAvailability() {
    availableQuizIndices = [...Array(allQuizzes.length).keys()];
    for (let i = availableQuizIndices.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [availableQuizIndices[i], availableQuizIndices[j]] = [availableQuizIndices[j], availableQuizIndices[i]];
    }
}

canvas.addEventListener("touchmove", e => {
  const touch = e.touches[0];
  const rect = canvas.getBoundingClientRect();
  paddle.x = touch.clientX - rect.left - paddle.w / 2;
});
canvas.addEventListener("mousemove", e => {
  const rect = canvas.getBoundingClientRect();
  paddle.x = e.clientX - rect.left - paddle.w / 2;
});

function createLogoBricks() {
  const brickW = 40, brickH = 16;
  const brickGap = 4;
  const cx = width / 2, cy = height / 3;
  const outer = 160, inner = 90;
  bricks = [];
  const allBrickPositions = []; 

  // 1. 모든 벽돌 생성 (폭탄 여부 제외)
  for (let y = 40; y < height / 1.5; y += brickH + brickGap) {
    for (let x = 40; x < width - 40; x += brickW + brickGap) {
      const dx = x - cx, dy = y - cy;
      const dist = Math.sqrt(dx * dx + dy * dy);
      const angle = Math.atan2(dy, dx);
      const circlePart = dist < outer && dist > inner && (angle < -0.5 || angle > 0.5);
      const slash = Math.abs(dy + dx * 0.5) < 20;
      
      if (circlePart || slash) {
        const newBrick = {
          x, y, w: brickW, h: brickH, 
          color: slash ? "#ff3c00" : "#39aaff", 
          visible: true, 
          isBomb: false, 
          bombHits: 0, 
          row: Math.floor((y - 40) / (brickH + brickGap)),
          col: Math.floor((x - 40) / (brickW + brickGap))
        };
        bricks.push(newBrick);
        allBrickPositions.push(bricks.length - 1);
      }
    }
  }

  // 2. 폭탄 벽돌 무작위 선정
  const bombIndices = [];
  while (bombIndices.length < NUM_BOMBS && allBrickPositions.length > 0) {
    const randomIndexInPos = Math.floor(Math.random() * allBrickPositions.length);
    const brickIndex = allBrickPositions.splice(randomIndexInPos, 1)[0];
    
    // 폭탄 속성 추가
    bricks[brickIndex].isBomb = true;
    bricks[brickIndex].bombHits = 3;
    bombIndices.push(brickIndex);
  }
}

function drawBricks() {
  bricks.forEach(b => {
    if (!b.visible) return;
    
    ctx.shadowBlur = 10;
    ctx.shadowColor = b.color;
    
    if (b.isBomb) {
        // 폭탄 벽돌 (빨간 테두리, 노란 중앙)
        ctx.fillStyle = '#ff4444'; 
        ctx.fillRect(b.x, b.y, b.w, b.h);
        ctx.fillStyle = b.bombHits === 3 ? '#ffff00' : 
                        b.bombHits === 2 ? '#ffcc00' :
                        '#ff9900'; 
        ctx.fillRect(b.x + 2, b.y + 2, b.w - 4, b.h - 4);

        // 남은 횟수 표시
        ctx.fillStyle = 'black';
        ctx.font = '10px Arial';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(b.bombHits, b.x + b.w / 2, b.y + b.h / 2);
    } else {
        // 일반 벽돌
        ctx.fillStyle = b.color;
        ctx.fillRect(b.x, b.y, b.w, b.h);
    }
  });
  ctx.shadowBlur = 0;
}

// 폭탄 벽돌 폭발 로직
function explodeBomb(bombBrick) {
    const explosionScore = 10;
    const { row: targetRow, col: targetCol } = bombBrick;
    
    const positionsToClear = [];
    for (let dr = -1; dr <= 1; dr++) {
        for (let dc = -1; dc <= 1; dc++) {
            positionsToClear.push({ row: targetRow + dr, col: targetCol + dc });
        }
    }

    bricks.forEach(brick => {
        if (!brick.visible) return;
        
        const isNear = positionsToClear.some(pos => pos.row === brick.row && pos.col === brick.col);
        
        if (isNear) {
            brick.visible = false;
            score += explosionScore; 
        }
    });

    updateScore();
}

function drawBall() {
  ctx.beginPath();
  ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI * 2);
  ctx.fillStyle = "#fff";
  ctx.shadowBlur = 15;
  ctx.shadowColor = "#00ffff";
  ctx.fill();
  ctx.closePath();
  ctx.shadowBlur = 0;
}

function drawPaddle() {
  ctx.fillStyle = "#00ccff";
  ctx.fillRect(paddle.x, height - 30, paddle.w, paddle.h);
}

function draw() {
  ctx.clearRect(0, 0, width, height);
  drawBricks();
  drawBall();
  drawPaddle();
}

function update() {
  if (!gameRunning || quizActive || pausedForResult) return;
  
  let oldDx = ball.dx;
  let oldDy = ball.dy;

  ball.x += ball.dx;
  ball.y += ball.dy;

  let bounced = false;

  // 벽 충돌
  if (ball.x + ball.r > width || ball.x - ball.r < 0) {
      ball.dx *= -1;
      bounced = true;
  }
  if (ball.y - ball.r < 0) {
      ball.dy *= -1;
      bounced = true;
  }

  // 패들 충돌
  if (ball.y + ball.r > height - 30 && ball.x > paddle.x && ball.x < paddle.x + paddle.w) {
    ball.dy = -Math.abs(ball.dy);
    bounced = true;
  }
  
  // 벽돌 충돌
  bricks.forEach(b => {
    if (b.visible &&
        ball.x > b.x && ball.x < b.x + b.w &&
        ball.y > b.y && ball.y < b.y + b.h) {
      
      // 공 반사
      ball.dy *= -1; 
      bounced = true;
      
      // 폭탄 벽돌 처리
      if (b.isBomb) {
        b.bombHits--;
        if (b.bombHits <= 0) {
            explodeBomb(b); 
        }
      } else {
        // 일반 벽돌 처리
        b.visible = false;
        score += 10;
        updateScore();
      }
    }
  });

  // 공이 튕겼다면 효과음 재생
  if (bounced) {
      playSfx(bounceSfx);
  }

  if (ball.y > height) {
    lives--;
    updateScore();
    if (lives <= 0) {
      endGame();
      return;
    } else {
      showLifeMessage(`라이프가 1 감소했습니다.\n\n남은 라이프: ${lives}`);
      ball = { x: width / 2, y: height - 40, dx: Math.abs(ball.dx), dy: -Math.abs(ball.dy), r: 8 };
    }
  }
  draw();
  requestAnimationFrame(update);
}

function updateScore() {
  document.getElementById("scoreBoard").textContent = `점수: ${score} | 라이프: ${lives}`;
}

function startQuiz() {
  if (!gameRunning) return;
  quizActive = true;
  gameRunning = false;
  
  if (availableQuizIndices.length === 0) {
      resetQuizAvailability(); 
  }
  const randomIndexInAvailable = Math.floor(Math.random() * availableQuizIndices.length);
  const quizIndex = availableQuizIndices.splice(randomIndexInAvailable, 1)[0];
  const q = allQuizzes[quizIndex];
  
  questionText.textContent = q.q;
  quizBox.style.display = "flex";
  timeLeft = 10;
  timerDisplay.textContent = `남은 시간: ${timeLeft}s`;
  quizTimer = setInterval(() => {
    timeLeft--;
    timerDisplay.textContent = `남은 시간: ${timeLeft}s`;
    if (timeLeft <= 0) {
      clearInterval(quizTimer);
      checkAnswer(false, q.a);
    }
  }, 1000);
  quizBox.dataset.answer = q.a;
}

function stopQuizTimer() {
  if (quizTimer) clearInterval(quizTimer);
}

function adjustBallSpeed(isCorrect) {
    let speed = Math.abs(ball.dx);
    
    if (isCorrect) {
        speed = Math.max(MIN_SPEED, speed - SPEED_CHANGE); 
    } else {
        speed = Math.min(MAX_SPEED, speed + SPEED_CHANGE); 
    }
    
    ball.dx = ball.dx > 0 ? speed : -speed;
    ball.dy = ball.dy > 0 ? speed : -speed;
}

function answerQuiz(ans) {
  playSfx(clickSfx); // 퀴즈 버튼 클릭 시 효과음
  stopQuizTimer();
  const correct = quizBox.dataset.answer === "true";
  checkAnswer(ans, correct);
}

function showResultMessage(text, color) {
  resultMsg.textContent = text;
  resultMsg.style.color = color;
  resultMsg.style.display = "block";
  pausedForResult = true;
  setTimeout(() => {
    resultMsg.style.display = "none";
    pausedForResult = false;
    gameRunning = true;
    update();
  }, 1500);
}

function showLifeMessage(text) {
  pausedForResult = true;
  lifeMsg.textContent = text;
  lifeMsg.style.display = "block";
  setTimeout(() => {
    lifeMsg.style.display = "none";
    pausedForResult = false;
    gameRunning = true;
    update();
  }, 1500);
}

function checkAnswer(selected, correct) {
  quizBox.style.display = "none";
  quizActive = false;
  
  adjustBallSpeed(selected === correct);

  if (selected === correct) {
    score += 200;
    showResultMessage("정답입니다!\n\n+200점", "#00ff88");
  } else {
    score -= 100;
    lives--;
    showResultMessage("오답입니다!\n\n-100점", "#ff5555");
  }
  updateScore();
  if (lives <= 0) endGame();
}

function startQuizCycle() {
  quizInterval = setInterval(() => {
    if (gameRunning && !quizActive && !pausedForResult) startQuiz();
  }, 10000);
}

function stopQuizCycle() {
  if (quizInterval) clearInterval(quizInterval);
}

function resetGame() {
  score = 0;
  lives = 3;
  createLogoBricks();
  updateScore();
  ball = { x: width / 2, y: height - 40, dx: 1.0, dy: -1.0, r: 8 }; 
  resetQuizAvailability(); 
}

function endGame() {
  stopQuizTimer();
  stopQuizCycle();
  gameRunning = false;
  quizActive = false;
  pausedForResult = false;
  
  bgm.pause(); // 게임 종료 시 BGM 정지
  
  document.getElementById("finalText").innerHTML = `게임 종료! <br><br> 최종 점수: ${score} <br><br> 남은 라이프: ${lives}`;
  
  document.getElementById("finalResult").style.display = "flex";
}

function returnToIntro() {
  playSfx(clickSfx); // 버튼 클릭 시 효과음
  document.getElementById("finalResult").style.display = "none";
  resetGame();
  document.getElementById("intro").style.display = "flex";
  document.getElementById("startBtn").style.display = "block";
}

createLogoBricks();
resetQuizAvailability();
setTimeout(() => {
  document.getElementById("startBtn").style.display = "block";
}, 3000);

function startGame() {
  playSfx(clickSfx); // 게임 시작 버튼 클릭 시 효과음
  document.getElementById("intro").style.display = "none";
  document.getElementById("finalResult").style.display = "none";
  resetGame();
  gameRunning = true;
  startQuizCycle();
  update();
  bgm.play().catch(e => console.log("BGM playback failed: User interaction required.", e)); // BGM 재생 시도
}
</script>
</body>
</html>
